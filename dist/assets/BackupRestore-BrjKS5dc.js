import{c as q,r as n,j as e,bA as E,E as N,h as p,L as B,b as v,ai as w,C as T,a2 as O,e as H,af as P,aV as F}from"./index-RP5sFzS9.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],L=q("hard-drive",$);function _({context:s}){const[f,b]=n.useState(!1),[k,j]=n.useState(!1),[c,h]=n.useState(null),[m,x]=n.useState(null),[D,u]=n.useState(!1),[d,g]=n.useState(null),S=async()=>{b(!0),h(null);try{const o={exportDate:new Date().toISOString(),exportDateIST:O(new Date().toISOString()),version:"1.0",data:{inventory:s.inventory||[],overheads:s.overheads||[],fixedCosts:s.fixedCosts||[],sales:s.salesData||[],categorySalesData:s.categorySalesData||[],productionData:s.productionData||[],productionHouses:s.productionHouses||[],stockRequests:s.stockRequests||[],productionRequests:s.productionRequests||[],stores:s.stores||[],inventoryItems:s.inventoryItems||[]},metadata:{totalInventoryItems:(s.inventory||[]).length,totalOverheadItems:(s.overheads||[]).length,totalFixedCostItems:(s.fixedCosts||[]).length,totalSalesRecords:(s.salesData||[]).length,totalCategorySalesData:(s.categorySalesData||[]).length,totalProductionRecords:(s.productionData||[]).length,totalProductionHouses:(s.productionHouses||[]).length,totalStockRequests:(s.stockRequests||[]).length,totalProductionRequests:(s.productionRequests||[]).length,totalStores:(s.stores||[]).length,totalInventoryItemTypes:(s.inventoryItems||[]).length}},t=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),l=URL.createObjectURL(t),i=document.createElement("a");i.href=l,i.download=`bhandar-ims-backup-${H()}-${Date.now()}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l),h({type:"success",message:`Backup created successfully! Downloaded ${Object.values(o.metadata).reduce((r,a)=>r+a,0)} total records.`})}catch(o){console.error("Export error:",o),h({type:"error",message:"Failed to export data. Please try again."})}finally{b(!1)}},I=o=>{const t=o.target.files?.[0];if(t){if(t.type!=="application/json"){x({type:"error",message:"Please select a valid JSON backup file."});return}g(t),u(!0),x(null)}},C=async()=>{if(!(!d||!s.user)){j(!0),x(null),u(!1);try{const o=await d.text(),t=JSON.parse(o);if(!t.data||!t.version)throw new Error("Invalid backup file format");let l={inventory:0,overheads:0,fixedCosts:0,sales:0,categorySalesData:0,productionData:0,productionHouses:0,stockRequests:0,productionRequests:0,stores:0,inventoryItems:0};if(t.data.inventory)for(const r of t.data.inventory)try{await s.addInventoryItem(r),l.inventory++}catch(a){console.error("Error importing inventory item:",a)}if(t.data.overheads)for(const r of t.data.overheads)try{await s.addOverheadItem(r),l.overheads++}catch(a){console.error("Error importing overhead:",a)}if(t.data.fixedCosts)for(const r of t.data.fixedCosts)try{await s.addFixedCostItem(r),l.fixedCosts++}catch(a){console.error("Error importing fixed cost:",a)}if(t.data.sales)for(const r of t.data.sales)try{await s.addSalesData(r),l.sales++}catch(a){console.error("Error importing sale:",a)}if(t.data.categorySalesData)for(const r of t.data.categorySalesData)try{await(void 0)(s.user.accessToken,r),l.categorySalesData++}catch(a){console.error("Error importing category sales data:",a)}if(t.data.productionData)for(const r of t.data.productionData)try{await s.addProductionData(r),l.productionData++}catch(a){console.error("Error importing production data:",a)}if(t.data.productionHouses)for(const r of t.data.productionHouses)try{await s.addProductionHouse(r),l.productionHouses++}catch(a){console.error("Error importing production house:",a)}if(t.data.stockRequests)for(const r of t.data.stockRequests)try{const{fulfilledQuantities:a,status:A,fulfilledBy:U,fulfilledByName:J,fulfillmentDate:M,notes:z,...R}=r;await s.createStockRequest(R),l.stockRequests++}catch(a){console.error("Error importing stock request:",a)}if(t.data.productionRequests)for(const r of t.data.productionRequests)try{await P(s.user.accessToken,r),l.productionRequests++}catch(a){console.error("Error importing production request:",a)}if(t.data.stores)for(const r of t.data.stores)try{await F(s.user.accessToken,r),l.stores++}catch(a){console.error("Error importing store:",a)}if(t.data.inventoryItems)for(const r of t.data.inventoryItems)try{await(void 0)(s.user.accessToken,r),l.inventoryItems++}catch(a){console.error("Error importing inventory item type:",a)}const i=Object.values(l).reduce((r,a)=>r+a,0);x({type:"success",message:`Successfully imported ${i} records! Page will reload in 3 seconds...`}),setTimeout(()=>{window.location.reload()},3e3)}catch(o){console.error("Import error:",o),x({type:"error",message:`Failed to import data: ${o instanceof Error?o.message:"Unknown error"}`})}finally{j(!1),g(null)}}},y=s.inventory.length+s.overheads.length+s.fixedCosts.length+s.salesData.length+s.categorySalesData.length+s.productionData.length+s.productionHouses.length+s.stockRequests.length+s.productionRequests.length+s.stores.length+s.inventoryItems.length;return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl shadow-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(E,{className:"w-8 h-8"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Backup & Restore"})]}),e.jsx("p",{className:"text-purple-100",children:"Protect your data by creating regular backups. Export your data to JSON files and restore when needed."})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(L,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Current Database"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Inventory Items"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:s.inventory.length})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Overhead Costs"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:s.overheads.length})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Fixed Costs"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:s.fixedCosts.length})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sales Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:s.salesData.length})]}),e.jsxs("div",{className:"bg-pink-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Category Sales Data"}),e.jsx("p",{className:"text-2xl font-bold text-pink-600",children:s.categorySalesData.length})]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Production Data"}),e.jsx("p",{className:"text-2xl font-bold text-indigo-600",children:s.productionData.length})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Production Houses"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:s.productionHouses.length})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Stock Requests"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:s.stockRequests.length})]}),e.jsxs("div",{className:"bg-teal-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Production Requests"}),e.jsx("p",{className:"text-2xl font-bold text-teal-600",children:s.productionRequests.length})]}),e.jsxs("div",{className:"bg-cyan-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Stores"}),e.jsx("p",{className:"text-2xl font-bold text-cyan-600",children:s.stores.length})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Inventory Item Types"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:s.inventoryItems.length})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-lg text-gray-900",children:[e.jsx("span",{className:"font-semibold",children:"Total Records:"})," ",y.toLocaleString()]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(N,{className:"w-5 h-5 text-green-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Export Data (Create Backup)"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(p,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"ðŸ’¡ Backup Best Practices:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[e.jsx("li",{children:"Create backups daily or after important data entry"}),e.jsx("li",{children:"Store backup files in multiple locations (Google Drive, external hard drive, etc.)"}),e.jsx("li",{children:"Name files with dates for easy identification"}),e.jsx("li",{children:"Test restoring from backups periodically"})]})]})]})}),e.jsx("button",{onClick:S,disabled:f||y===0,className:"w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-lg font-semibold",children:f?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-5 h-5 animate-spin"}),"Creating Backup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5"}),"Download Backup (",y," records)"]})}),c&&e.jsxs("div",{className:`mt-4 p-4 rounded-lg flex items-start gap-3 ${c.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[c.type==="success"?e.jsx(v,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(p,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${c.type==="success"?"text-green-800":"text-red-800"}`,children:c.message})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(w,{className:"w-5 h-5 text-orange-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Import Data (Restore Backup)"})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(p,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"âš ï¸ Important Warning:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[e.jsxs("li",{children:["Importing will ",e.jsx("strong",{children:"ADD"})," data from the backup file to your current database"]}),e.jsx("li",{children:"This may create duplicate records if the same data already exists"}),e.jsx("li",{children:"Create a backup of your current data before importing"}),e.jsx("li",{children:"Only use backup files created by this system"})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"file",accept:".json",onChange:I,disabled:k,className:"w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-orange-400 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"}),d&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Selected file:"}),e.jsx("p",{className:"text-gray-900 font-medium",children:d.name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(d.size/1024).toFixed(2)," KB"]})]})]}),m&&e.jsxs("div",{className:`mt-4 p-4 rounded-lg flex items-start gap-3 ${m.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[m.type==="success"?e.jsx(v,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(p,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${m.type==="success"?"text-green-800":"text-red-800"}`,children:m.message})]})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(p,{className:"w-6 h-6 text-orange-600"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Confirm Import"})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("p",{className:"text-gray-700",children:"Are you sure you want to import data from this backup file?"}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Warning:"})," This will add all records from the backup file to your current database. Make sure you've created a backup of your current data first!"]})}),e.jsx("div",{className:"bg-gray-50 rounded p-3",children:e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:d?.name})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{u(!1),g(null)},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:C,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),"Import Data"]})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(T,{className:"w-6 h-6 text-purple-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ðŸ“… Recommended Backup Schedule"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-600 font-bold",children:"â€¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Daily:"})," At the end of each business day (especially after sales entry)"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-600 font-bold",children:"â€¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Weekly:"})," Every Sunday for weekly records"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-600 font-bold",children:"â€¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Monthly:"})," On the last day of each month before monthly reports"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-600 font-bold",children:"â€¢"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Before Major Changes:"})," Always backup before bulk edits or deletions"]})]})]})]})]})})]})}export{_ as BackupRestore};
