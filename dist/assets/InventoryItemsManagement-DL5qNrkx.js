import{r as a,bx as u,by as g,j as e,P as B,h as U,X as S,aH as G,Z as C,aS as O,aj as R,_ as K,ac as J}from"./index-BWZpdZV9.js";import{C as p,B as X}from"./badge-zViWTQCm.js";function V({context:d}){const[i,T]=a.useState([]),[j,x]=a.useState(!0),[v,m]=a.useState(!1),[n,y]=a.useState(null),[N,o]=a.useState(null),[k,c]=a.useState(null),[s,l]=a.useState({displayName:"",category:"finished_product",unit:"pieces",linkedEntityType:"global",linkedEntityId:""}),[b,_]=a.useState("all"),[f,A]=a.useState("all");a.useEffect(()=>{h()},[]);const h=async()=>{try{x(!0);const t=await fetch(`https://${u}.supabase.co/functions/v1/make-server-c2dd9b9d/inventory-items`,{headers:{Authorization:`Bearer ${g}`}});if(!t.ok)throw new Error("Failed to load inventory items");const r=await t.json();T(r.items||[])}catch(t){console.error("Error loading items:",t),o(t instanceof Error?t.message:"Failed to load items")}finally{x(!1)}},F=async t=>{t.preventDefault(),o(null),c(null);try{const L={name:s.displayName.toLowerCase().replace(/\s+/g,"_"),displayName:s.displayName,category:s.category,unit:s.unit,linkedEntityType:s.linkedEntityType,linkedEntityId:s.linkedEntityType==="global"?void 0:s.linkedEntityId,userId:d.user?.employeeId||"unknown"},M=n?`https://${u}.supabase.co/functions/v1/make-server-c2dd9b9d/inventory-items/${n}`:`https://${u}.supabase.co/functions/v1/make-server-c2dd9b9d/inventory-items`,I=await fetch(M,{method:n?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify(L)});if(!I.ok){const q=await I.json();throw new Error(q.error||"Failed to save item")}c(n?"Item updated successfully!":"Item created successfully!"),m(!1),y(null),l({displayName:"",category:"finished_product",unit:"pieces",linkedEntityType:"global",linkedEntityId:""}),await h()}catch(r){console.error("Error saving item:",r),o(r instanceof Error?r.message:"Failed to save item")}},P=t=>{y(t.id),l({displayName:t.displayName,category:t.category,unit:t.unit,linkedEntityType:t.linkedEntityType,linkedEntityId:t.linkedEntityId||""}),m(!0)},D=async t=>{if(confirm("Are you sure you want to delete this item?"))try{if(!(await fetch(`https://${u}.supabase.co/functions/v1/make-server-c2dd9b9d/inventory-items/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${g}`}})).ok)throw new Error("Failed to delete item");c("Item deleted successfully!"),await h()}catch(r){console.error("Error deleting item:",r),o(r instanceof Error?r.message:"Failed to delete item")}},w=async()=>{if(confirm("This will add the 7 default momo types as global items. Continue?"))try{if(x(!0),!(await fetch(`https://${u}.supabase.co/functions/v1/make-server-c2dd9b9d/inventory-items/initialize-defaults`,{method:"POST",headers:{Authorization:`Bearer ${g}`}})).ok)throw new Error("Failed to initialize defaults");c("Default items initialized successfully!"),await h()}catch(t){console.error("Error initializing defaults:",t),o(t instanceof Error?t.message:"Failed to initialize defaults")}finally{x(!1)}},z=()=>{m(!1),y(null),l({displayName:"",category:"finished_product",unit:"pieces",linkedEntityType:"global",linkedEntityId:""})},E=i.filter(t=>!(b!=="all"&&t.category!==b||f!=="all"&&t.linkedEntityType!==f)),$=t=>{switch(t){case"finished_product":return"bg-purple-100 text-purple-800";case"raw_material":return"bg-blue-100 text-blue-800";case"sauce_chutney":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},H=t=>{switch(t){case"store":return e.jsx(J,{className:"w-4 h-4"});case"production_house":return e.jsx(K,{className:"w-4 h-4"});default:return e.jsx(C,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl text-gray-900 mb-2",children:"Inventory Items Master"}),e.jsx("p",{className:"text-gray-600",children:"Manage all inventory items for stores and production houses"})]}),e.jsxs("div",{className:"flex gap-3",children:[i.length===0&&e.jsx("button",{onClick:w,disabled:j,className:"px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all disabled:opacity-50",children:"Initialize Defaults"}),e.jsxs("button",{onClick:()=>m(!v),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:shadow-lg transition-all",children:[e.jsx(B,{className:"w-5 h-5"}),"Add New Item"]})]})]}),N&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",children:[e.jsx(U,{className:"w-5 h-5 text-red-600"}),e.jsx("p",{className:"text-red-800",children:N}),e.jsx("button",{onClick:()=>o(null),className:"ml-auto",children:e.jsx(S,{className:"w-4 h-4 text-red-600"})})]}),k&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg flex items-center gap-3",children:[e.jsx(G,{className:"w-5 h-5 text-green-600"}),e.jsx("p",{className:"text-green-800",children:k}),e.jsx("button",{onClick:()=>c(null),className:"ml-auto",children:e.jsx(S,{className:"w-4 h-4 text-green-600"})})]}),v&&e.jsxs(p,{className:"p-6 border-2 border-purple-200",children:[e.jsx("h2",{className:"text-xl mb-4",children:n?"Edit Item":"Add New Item"}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 text-gray-700",children:"Display Name *"}),e.jsx("input",{type:"text",value:s.displayName,onChange:t=>l({...s,displayName:t.target.value}),placeholder:"e.g., Schezwan Momo",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 text-gray-700",children:"Category *"}),e.jsxs("select",{value:s.category,onChange:t=>l({...s,category:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"finished_product",children:"Finished Product"}),e.jsx("option",{value:"raw_material",children:"Raw Material"}),e.jsx("option",{value:"sauce_chutney",children:"Sauce/Chutney"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 text-gray-700",children:"Unit *"}),e.jsxs("select",{value:s.unit,onChange:t=>l({...s,unit:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"pieces",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms (kg)"}),e.jsx("option",{value:"liters",children:"Liters"}),e.jsx("option",{value:"grams",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters (ml)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 text-gray-700",children:"Link To *"}),e.jsxs("select",{value:s.linkedEntityType,onChange:t=>l({...s,linkedEntityType:t.target.value,linkedEntityId:""}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"global",children:"All (Global)"}),e.jsx("option",{value:"store",children:"Specific Store"}),e.jsx("option",{value:"production_house",children:"Specific Production House"})]})]}),s.linkedEntityType==="store"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 text-gray-700",children:"Select Store *"}),e.jsxs("select",{value:s.linkedEntityId,onChange:t=>l({...s,linkedEntityId:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"-- Select Store --"}),d.stores?.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),s.linkedEntityType==="production_house"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 text-gray-700",children:"Select Production House *"}),e.jsxs("select",{value:s.linkedEntityId,onChange:t=>l({...s,linkedEntityId:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"-- Select Production House --"}),d.productionHouses?.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:z,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:shadow-lg",children:n?"Update Item":"Add Item"})]})]})]}),e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 text-gray-700",children:"Filter by Category"}),e.jsxs("select",{value:b,onChange:t=>_(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"finished_product",children:"Finished Products"}),e.jsx("option",{value:"raw_material",children:"Raw Materials"}),e.jsx("option",{value:"sauce_chutney",children:"Sauces/Chutneys"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 text-gray-700",children:"Filter by Type"}),e.jsxs("select",{value:f,onChange:t=>A(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"global",children:"Global Items"}),e.jsx("option",{value:"store",children:"Store Specific"}),e.jsx("option",{value:"production_house",children:"Production House Specific"})]})]})]})}),j?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-purple-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading items..."})]}):E.length===0?e.jsxs(p,{className:"p-12 text-center",children:[e.jsx(C,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl text-gray-600 mb-2",children:"No items found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by adding your first inventory item"}),i.length===0&&e.jsx("button",{onClick:w,className:"px-6 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:shadow-lg",children:"Initialize Default Items"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map(t=>e.jsxs(p,{className:"p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[H(t.linkedEntityType),e.jsx("h3",{className:"font-semibold text-gray-900",children:t.displayName})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>P(t),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"Edit",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>D(t.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete",children:e.jsx(R,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:$(t.category),children:t.category.replace("_"," ").toUpperCase()}),e.jsxs("span",{className:"text-gray-500",children:["â€¢ ",t.unit]})]}),e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Scope:"})," ",t.linkedEntityType==="global"?"All Entities":t.linkedEntityType==="store"?`Store: ${d.stores?.find(r=>r.id===t.linkedEntityId)?.name||"Unknown"}`:`Production House: ${d.productionHouses?.find(r=>r.id===t.linkedEntityId)?.name||"Unknown"}`]}),e.jsxs("div",{className:"text-xs text-gray-400 pt-2 border-t",children:["Created: ",new Date(t.createdAt).toLocaleDateString()]})]})]},t.id))}),e.jsx(p,{className:"p-6 bg-gradient-to-r from-purple-50 to-pink-50",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl text-purple-600",children:i.filter(t=>t.isActive).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Items"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl text-blue-600",children:i.filter(t=>t.linkedEntityType==="global").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Global Items"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl text-green-600",children:i.filter(t=>t.linkedEntityType==="store").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Store Specific"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl text-orange-600",children:i.filter(t=>t.linkedEntityType==="production_house").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Production House"})]})]})})]})}export{V as InventoryItemsManagement};
