import{c as es,r as d,g as Ws,a as _s,j as e,D as Ne,W as je,T as Gs,C as vs,b as Ns,s as gt,d as yt,e as ws,f as ft,h as Qe,i as Zs,F as Vs,U as bt,S as Ys,k as jt,l as Nt,m as is,n as vt,o as wt,p as St,q as Ct,t as be,u as Je,v as Bs,w as Dt,P as Hs,X as ds,L as bs,x as $s,y as Ft,z as qs,A as Pt}from"./index-RP5sFzS9.js";import{T as Us}from"./trending-down-DL1x9TwU.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],js=es("arrow-right-left",At);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],kt=es("circle-arrow-down",It);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],Ot=es("percent",Mt);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]],zs=es("shopping-bag",Et);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],cs=es("smartphone",Rt);function Lt({context:a,selectedStoreId:D,selectedDate:L,onDateChange:z,onDataUpdate:n}){const[Y,H]=d.useState(""),[ee,le]=d.useState(""),[oe,K]=d.useState(""),[ce,ie]=d.useState(""),[T,X]=d.useState([]),[l,U]=d.useState([]),[se,te]=d.useState(!1),[$,W]=d.useState(!1),C=D||a.user?.storeId,_=a.user?.role==="manager"||a.user?.role==="cluster_head";d.useEffect(()=>{O()},[]);const O=async()=>{if(a.user){te(!0);try{const M=await Ws(a.user.accessToken),S=await _s(a.user.accessToken);X(M||[]),U(S||[])}catch(M){console.error("Error loading online data:",M)}finally{te(!1)}}},E=d.useMemo(()=>(C?T.filter(S=>S.storeId===C):T).find(S=>S.date===L),[T,L,C]),k=d.useMemo(()=>(C?l.filter(S=>S.storeId===C):l).find(S=>S.date===L),[l,L,C]);d.useEffect(()=>{E?(H(E.swiggySales.toString()),le(E.zomatoSales.toString())):(H(""),le("")),k?(K(k.swiggyPayout.toString()),ie(k.zomatoPayout.toString())):(K(""),ie(""))},[E,k,L]);const ae=parseFloat(Y)||0,he=parseFloat(ee)||0,ge=ae+he,ve=parseFloat(oe)||0,v=parseFloat(ce)||0,me=ve+v,G=ge-me,J=me-ge,ye=d.useMemo(()=>{const M=C?T.filter(q=>q.storeId===C):T,S=C?l.filter(q=>q.storeId===C):l,ue=M.reduce((q,de)=>q+de.swiggySales+de.zomatoSales,0),w=S.reduce((q,de)=>q+de.swiggyPayout+de.zomatoPayout,0);return{totalSales:ue,totalPayouts:w,netCommission:ue-w}},[T,l,C]),we=async M=>{if(M.preventDefault(),!(!a.user||!_)){W(!0);try{const S={id:E?.id||`ONLINE-SALES-${Date.now()}`,date:L,swiggySales:ae,zomatoSales:he,storeId:C,createdAt:E?.createdAt||new Date().toISOString()};await gt(a.user.accessToken,S);const ue={id:k?.id||`ONLINE-PAYOUT-${Date.now()}`,date:L,swiggyPayout:ve,zomatoPayout:v,storeId:C,createdAt:k?.createdAt||new Date().toISOString()};if(await yt(a.user.accessToken,ue),J>0){const w=a.salesData.find(q=>q.date===L&&(!C||q.storeId===C));w&&await a.updateSalesData(w.id,{...w,paytmAmount:w.paytmAmount+J})}await O(),n&&n(),alert("âœ… Online sales and payout data saved successfully!")}catch(S){console.error("Error saving online data:",S),alert("âŒ Error saving online data. Please try again.")}finally{W(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6 border border-purple-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Online Sales Management (Swiggy & Zomato)"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Track sales and payouts from food delivery aggregators. Extra payouts automatically add to Online Cash in Hand (Paytm)."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border-2 border-green-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Sales (Till Now)"}),e.jsx(Ne,{className:"w-5 h-5 text-green-600"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["â‚¹",ye.totalSales.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border-2 border-blue-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Net Payout (Till Now)"}),e.jsx(je,{className:"w-5 h-5 text-blue-600"})]}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["â‚¹",ye.totalPayouts.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border-2 border-purple-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Net Commission (Till Now)"}),e.jsx(Gs,{className:"w-5 h-5 text-purple-600"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["â‚¹",ye.netCommission.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Sales - Payout"})]})]}),e.jsxs("form",{onSubmit:we,className:"bg-white rounded-lg p-6 border-2 border-purple-200 shadow-lg",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(vs,{className:"w-5 h-5"}),"Daily Entry for ",new Date(L).toLocaleDateString("en-IN",{day:"numeric",month:"long",year:"numeric"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700 border-b pb-2",children:"Sales Data"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Swiggy Sales (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:Y,onChange:M=>H(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0.00",disabled:!_})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Zomato Sales (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:ee,onChange:M=>le(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0.00",disabled:!_})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Total Online Sales"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["â‚¹",ge.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700 border-b pb-2",children:"Payout Data"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Swiggy Payout (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:oe,onChange:M=>K(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0.00",disabled:!_})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Zomato Payout (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:ce,onChange:M=>ie(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0.00",disabled:!_})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Total Payout"}),e.jsxs("p",{className:"text-xl font-bold text-blue-600",children:["â‚¹",me.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${G>=0?"bg-purple-50 border-2 border-purple-200":"bg-red-50 border-2 border-red-200"}`,children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Net Commission (Sales - Payout)"}),e.jsxs("p",{className:`text-2xl font-bold ${G>=0?"text-purple-600":"text-red-600"}`,children:["â‚¹",G.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["This is the commission ",G>=0?"earned":"deficit"]})]}),J>0&&e.jsxs("div",{className:"p-4 rounded-lg bg-orange-50 border-2 border-orange-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Extra Payout (Payout - Sales)"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["â‚¹",J.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"âš¡ This will be added to Online Cash in Hand (Paytm)"})]})]}),_&&e.jsx("div",{className:"mt-6",children:e.jsx("button",{type:"submit",disabled:$,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:$?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ns,{className:"w-5 h-5"}),"Save Online Sales & Payout"]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border-2 border-purple-200 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Daily Breakdown"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700",children:"Swiggy Sales"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700",children:"Zomato Sales"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700",children:"Total Sales"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700",children:"Swiggy Payout"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700",children:"Zomato Payout"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700",children:"Total Payout"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-gray-700",children:"Commission"})]})}),e.jsx("tbody",{children:(()=>{const M=new Set([...T.map(w=>w.date),...l.map(w=>w.date)]),S=C?T.filter(w=>w.storeId===C):T,ue=C?l.filter(w=>w.storeId===C):l;return Array.from(M).sort((w,q)=>q.localeCompare(w)).map(w=>{const q=S.find(fe=>fe.date===w),de=ue.find(fe=>fe.date===w),Re=q?.swiggySales||0,ss=q?.zomatoSales||0,Le=Re+ss,ts=de?.swiggyPayout||0,Te=de?.zomatoPayout||0,Be=ts+Te,He=Le-Be;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 text-gray-700",children:new Date(w).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})}),e.jsxs("td",{className:"py-3 px-4 text-right text-gray-700",children:["â‚¹",Re.toFixed(2)]}),e.jsxs("td",{className:"py-3 px-4 text-right text-gray-700",children:["â‚¹",ss.toFixed(2)]}),e.jsxs("td",{className:"py-3 px-4 text-right font-semibold text-green-600",children:["â‚¹",Le.toFixed(2)]}),e.jsxs("td",{className:"py-3 px-4 text-right text-gray-700",children:["â‚¹",ts.toFixed(2)]}),e.jsxs("td",{className:"py-3 px-4 text-right text-gray-700",children:["â‚¹",Te.toFixed(2)]}),e.jsxs("td",{className:"py-3 px-4 text-right font-semibold text-blue-600",children:["â‚¹",Be.toFixed(2)]}),e.jsxs("td",{className:`py-3 px-4 text-right font-semibold ${He>=0?"text-purple-600":"text-red-600"}`,children:["â‚¹",He.toFixed(2)]})]},w)})})()})]})})]})]})}function Tt({context:a,selectedStoreId:D,selectedDate:L,onClose:z,onSaveSuccess:n}){const[Y,H]=d.useState(""),[ee,le]=d.useState(L||ws()),[oe,K]=d.useState(""),[ce,ie]=d.useState(""),[T,X]=d.useState(""),[l,U]=d.useState(!1),[se,te]=d.useState(null),[$,W]=d.useState(!1),[C,_]=d.useState([]),[O,E]=d.useState(!0),k=D||a.user?.storeId,ae=a.stores?.find(v=>v.id===k),he=ae?.name||"Unknown Store";d.useEffect(()=>{ge()},[a.user]);const ge=async()=>{if(a.user?.accessToken)try{E(!0);const v=await ft(a.user.accessToken);_(v)}catch(v){console.error("Error loading investors:",v)}finally{E(!1)}};if(!k||!ae)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:z,children:e.jsx("div",{className:"bg-white rounded-xl max-w-lg w-full shadow-2xl p-6",onClick:v=>v.stopPropagation(),children:e.jsxs("div",{className:"text-center",children:[e.jsx(Qe,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Store Not Selected"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please select a store from the dropdown at the top of the page before applying for a loan."}),e.jsx("button",{onClick:z,className:"px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",children:"Close"})]})})});const ve=async v=>{if(v.preventDefault(),!a.user?.accessToken||!k){te("Missing authentication or store information");return}const me=parseFloat(Y);if(isNaN(me)||me<=0){te("Please enter a valid loan amount");return}try{U(!0),te(null);const G={storeId:k,storeName:he,loanAmount:me,loanDate:ee,notes:oe,createdBy:a.user.email,investorId:ce,interestRate:parseFloat(T)||0};await jt(a.user.accessToken,G),W(!0),setTimeout(()=>{n&&n(),z()},1500)}catch(G){console.error("Error applying for loan:",G),te(G.message||"Failed to apply for loan")}finally{U(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:z,children:e.jsxs("div",{className:"bg-white rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl",onClick:v=>v.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ne,{className:"w-6 h-6"}),"Apply for Loan"]}),e.jsx("p",{className:"text-purple-100 mt-1",children:he})]}),e.jsx("button",{onClick:z,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(Zs,{className:"w-6 h-6"})})]})}),$&&e.jsxs("div",{className:"m-6 p-4 bg-green-50 border-2 border-green-200 rounded-lg flex items-center gap-3",children:[e.jsx(Ne,{className:"w-6 h-6 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Loan Applied Successfully!"}),e.jsx("p",{className:"text-sm text-green-700",children:"The loan amount has been added to your Online Cash in Hand."})]})]}),se&&e.jsxs("div",{className:"m-6 p-4 bg-red-50 border-2 border-red-200 rounded-lg flex items-center gap-3",children:[e.jsx(Qe,{className:"w-6 h-6 text-red-600 flex-shrink-0"}),e.jsx("p",{className:"text-red-900",children:se})]}),e.jsxs("form",{onSubmit:ve,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Loan Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-lg",children:"â‚¹"}),e.jsx("input",{type:"number",step:"0.01",value:Y,onChange:v=>H(v.target.value),className:"w-full pl-8 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-lg",placeholder:"Enter loan amount",required:!0})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"This amount will be added to your Online Cash in Hand (Paytm)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Loan Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-5 h-5"}),e.jsx("input",{type:"date",value:ee,onChange:v=>le(v.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Notes / Purpose"}),e.jsxs("div",{className:"relative",children:[e.jsx(Vs,{className:"absolute left-3 top-3 text-gray-500 w-5 h-5"}),e.jsx("textarea",{value:oe,onChange:v=>K(v.target.value),rows:3,className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Purpose of loan, source, repayment terms, etc."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Investor *"}),e.jsxs("div",{className:"relative",children:[e.jsx(bt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-5 h-5"}),e.jsxs("select",{value:ce,onChange:v=>ie(v.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Investor"}),O?e.jsx("option",{value:"",children:"Loading..."}):C.map(v=>e.jsx("option",{value:v.id,children:v.name},v.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Interest Rate *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-5 h-5"}),e.jsx("input",{type:"number",step:"0.01",value:T,onChange:v=>X(v.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter interest rate",required:!0})]})]}),e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Qe,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900",children:[e.jsx("p",{className:"font-semibold mb-1",children:"ğŸ’¡ How Loans Work"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:["Loan amount is ",e.jsx("strong",{children:"added"})," to Online Cash in Hand (Paytm)"]}),e.jsx("li",{children:"Track active loans in the loan section below"}),e.jsx("li",{children:'Use "Repay Loan" to pay back (reduces Online Cash in Hand)'}),e.jsx("li",{children:"Supports partial and full repayments"})]})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:z,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",disabled:l,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:l||!Y,className:"flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ys,{className:"w-5 h-5"}),"Apply for Loan"]})})]})]})]})})}function Bt({context:a,loan:D,selectedDate:L,onClose:z,onSaveSuccess:n}){const Y=D.loanAmount-D.repaidAmount,[H,ee]=d.useState("0"),[le,oe]=d.useState(L||ws()),[K,ce]=d.useState(""),[ie,T]=d.useState(!1),[X,l]=d.useState(null),[U,se]=d.useState(!1),$=(O=>{if(!D.interestRate||D.interestRate===0)return 0;const E=new Date(D.loanDate),k=new Date(O),ae=Math.floor((k.getTime()-E.getTime())/(1e3*60*60*24)),he=D.loanAmount*D.interestRate*ae/3e3;return Math.max(0,he)})(le),W=Y+$;d.useEffect(()=>{ee(W.toFixed(2))},[$]);const C=async O=>{if(O.preventDefault(),!a.user?.accessToken){l("Missing authentication");return}const E=parseFloat(H);if(isNaN(E)||E<=0){l("Please enter a valid repayment amount");return}if(E>W){l(`Repayment amount cannot exceed total amount with interest (â‚¹${W.toLocaleString()})`);return}try{T(!0),l(null),await Nt(a.user.accessToken,D.id,{repaymentAmount:E,repaymentDate:le,notes:K}),se(!0),setTimeout(()=>{n&&n(),z()},1500)}catch(k){console.error("Error repaying loan:",k),l(k.message||"Failed to process loan repayment")}finally{T(!1)}},_=parseFloat(H)===W;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:z,children:e.jsxs("div",{className:"bg-white rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl",onClick:O=>O.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Us,{className:"w-6 h-6"}),"Repay Loan"]}),e.jsx("p",{className:"text-green-100 mt-1",children:D.storeName})]}),e.jsx("button",{onClick:z,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(Zs,{className:"w-6 h-6"})})]})}),U&&e.jsxs("div",{className:"m-6 p-4 bg-green-50 border-2 border-green-200 rounded-lg flex items-center gap-3",children:[e.jsx(Us,{className:"w-6 h-6 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Loan Repayment Successful!"}),e.jsx("p",{className:"text-sm text-green-700",children:"The amount has been deducted from your Online Cash in Hand."})]})]}),X&&e.jsxs("div",{className:"m-6 p-4 bg-red-50 border-2 border-red-200 rounded-lg flex items-center gap-3",children:[e.jsx(Qe,{className:"w-6 h-6 text-red-600 flex-shrink-0"}),e.jsx("p",{className:"text-red-900",children:X})]}),e.jsxs("div",{className:"m-6 p-4 bg-gradient-to-br from-purple-50 to-pink-50 border-2 border-purple-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"Loan Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Original Loan:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["â‚¹",D.loanAmount.toLocaleString()]})]}),D.interestRate&&D.interestRate>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Interest Rate:"}),e.jsxs("span",{className:"font-semibold text-blue-700",children:[D.interestRate,"% per month"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Already Repaid:"}),e.jsxs("span",{className:"font-semibold text-green-700",children:["â‚¹",D.repaidAmount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-purple-300",children:[e.jsx("span",{className:"text-gray-700 font-semibold",children:"Remaining Principal:"}),e.jsxs("span",{className:"font-bold text-purple-900",children:["â‚¹",Y.toLocaleString()]})]}),D.interestRate&&D.interestRate>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Interest Accrued (till repayment date):"}),e.jsxs("span",{className:"font-semibold text-orange-700",children:["â‚¹",$.toFixed(2)]})]}),$>0&&e.jsxs("div",{className:"flex justify-between pt-2 border-t-2 border-purple-400",children:[e.jsx("span",{className:"text-gray-900 font-bold",children:"Total Amount (with interest):"}),e.jsxs("span",{className:"font-bold text-red-700 text-lg",children:["â‚¹",W.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),$===0&&e.jsx("p",{className:"text-xs text-gray-600 italic",children:"ğŸ’¡ Change the repayment date to see interest calculation"})]}),e.jsxs("div",{className:"flex justify-between text-xs pt-2 border-t border-purple-200",children:[e.jsx("span",{className:"text-gray-600",children:"Loan Date:"}),e.jsx("span",{className:"text-gray-800",children:new Date(D.loanDate).toLocaleDateString("en-IN")})]})]})]}),e.jsxs("form",{onSubmit:C,className:"p-6 pt-0 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Repayment Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-lg",children:"â‚¹"}),e.jsx("input",{type:"number",step:"0.01",value:H,onChange:O=>ee(O.target.value),max:W,className:"w-full pl-8 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-lg",placeholder:"Enter repayment amount",required:!0})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("p",{className:"text-xs text-gray-600",children:_?"âœ… Full repayment":"âš ï¸ Partial repayment"}),e.jsx("button",{type:"button",onClick:()=>ee(W.toString()),className:"text-xs text-purple-600 hover:text-purple-700 font-medium",children:"Pay Full Amount"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Repayment Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-5 h-5"}),e.jsx("input",{type:"date",value:le,onChange:O=>oe(O.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Vs,{className:"absolute left-3 top-3 text-gray-500 w-5 h-5"}),e.jsx("textarea",{value:K,onChange:O=>ce(O.target.value),rows:2,className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Optional notes about this repayment..."})]})]}),e.jsx("div",{className:"bg-yellow-50 border-2 border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Qe,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-900",children:[e.jsx("p",{className:"font-semibold mb-1",children:"âš ï¸ Important"}),e.jsxs("p",{children:["This repayment amount will be ",e.jsx("strong",{children:"deducted"})," from your Online Cash in Hand (Paytm) balance. Make sure you have sufficient funds."]})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:z,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",disabled:ie,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:ie||!H,className:"flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:ie?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ys,{className:"w-5 h-5"}),_?"Pay Full Amount":"Make Payment"]})})]})]})]})})}function qt({context:a,selectedStoreId:D}){const[L,z]=d.useState("offline"),[n,Y]=d.useState(ws()),[H,ee]=d.useState([]),[le,oe]=d.useState(!1),[K,ce]=d.useState([]),[ie,T]=d.useState(!1),X=s=>s.category==="service_charge"&&s.description?.includes("Aggregator Commission")||s.category==="commission",[l,U]=d.useState({offlineSales:"",paytmAmount:"",cashAmount:"",employeeSalary:"",previousCashInHand:"",usedOnlineMoney:"",actualCashInHand:"",actualPaytmBalance:""}),[se,te]=d.useState(!1),[$,W]=d.useState(null),[C,_]=d.useState(!1),[O,E]=d.useState(!1),[k,ae]=d.useState(!1),[he,ge]=d.useState(null),[ve,v]=d.useState(!1),[me,G]=d.useState(!1),[J,ye]=d.useState(""),[we,M]=d.useState(!1),[S,ue]=d.useState(null),[w,q]=d.useState([]),[de,Re]=d.useState(!1),[ss,Le]=d.useState(!1),[ts,Te]=d.useState(!1),[Be,He]=d.useState(null),fe=a.user?.role==="cluster_head",Ks=a.user?.role==="manager",Xs=a.user?.designation==="store_incharge",Js=a.user?.designation==="production_incharge",Se=Ks&&!Xs&&!Js,re=Se,o=D||a.user?.storeId,[xe,Qs]=d.useState([]),[Q,as]=d.useState([]),[et,Ss]=d.useState(!1),[Ce,st]=d.useState([]);d.useEffect(()=>{rt()},[]),d.useEffect(()=>{Cs()},[a.user]);const Cs=async()=>{if(a.user?.accessToken)try{const s=await is();st(s)}catch(s){console.error("Error loading employee payouts:",s)}};d.useEffect(()=>{tt()},[a.user]);const tt=async()=>{if(a.user?.accessToken){oe(!0);try{const s=await _s(a.user.accessToken);ee(s)}catch(s){console.error("Error loading online payout data:",s)}finally{oe(!1)}}};d.useEffect(()=>{Ds()},[a.user]);const Ds=async()=>{if(a.user?.accessToken){T(!0);try{const s=await Ws(a.user.accessToken);ce(s)}catch(s){console.error("Error loading online sales data:",s)}finally{T(!1)}}};d.useEffect(()=>{ms()},[a.user,o]);const ms=async()=>{if(a.user?.accessToken){Re(!0);try{const s=!o||o==="all"?void 0:o,t=await vt(a.user.accessToken,s);q(t)}catch(s){console.error("Error loading online loans:",s)}finally{Re(!1)}}};d.useEffect(()=>{const s=t=>{t.key==="Escape"&&O&&xs()};if(O)return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[O]),d.useEffect(()=>{at()},[a.user,o]);const at=async()=>{if(!o||o==="all"){ue(null);return}if(a.user?.accessToken)try{const t=(await wt(a.user.accessToken,o))?.recalibration||null;ue(t)}catch(s){console.error("Error loading online recalibration:",s)}},rt=async()=>{Ss(!0);try{const t=(await St()).filter(r=>r.type==="contract");Qs(t)}catch(s){console.error("Error loading contract workers:",s)}finally{Ss(!1)}};d.useEffect(()=>{nt()},[n,xe]);const nt=async()=>{if(xe.length!==0)try{const t=(await is()).filter(p=>p.date===n),r=xe.map(p=>p.id),i=t.filter(p=>r.includes(p.employeeId)),x=new Map;i.forEach(p=>{const B=x.get(p.employeeId);(!B||new Date(p.createdAt)>new Date(B.createdAt))&&x.set(p.employeeId,p)});const u=Array.from(x.values()).map(p=>({employeeId:p.employeeId,amount:p.amount.toString()}));as(u)}catch(s){console.error("Error loading payouts for date:",s)}},lt=()=>{as([...Q,{employeeId:"",amount:""}])},ot=s=>{as(Q.filter((t,r)=>r!==s))},Fs=(s,t,r)=>{const i=[...Q];i[s][t]=r,as(i)},R=d.useMemo(()=>Q.reduce((s,t)=>s+(parseFloat(t.amount)||0),0),[Q]),f=d.useMemo(()=>{console.log("ğŸª SalesManagement - effectiveStoreId:",o),console.log("ğŸª SalesManagement - selectedStoreId prop:",D),console.log("ğŸª SalesManagement - user storeId:",a.user?.storeId),console.log("ğŸª SalesManagement - selectedDate:",n),console.log("ğŸª SalesManagement - all sales data:",a.salesData.map(r=>({id:r.id.substring(0,8),date:r.date,storeId:r.storeId,offlineSales:r.offlineSales})));const s=o?a.salesData.filter(r=>r.storeId===o):a.salesData;console.log("ğŸª SalesManagement - filtered sales:",s.map(r=>({id:r.id.substring(0,8),date:r.date,storeId:r.storeId})));const t=s.find(r=>r.date===n);return console.log("ğŸª SalesManagement - salesForDate result:",t?{id:t.id.substring(0,8),date:t.date,storeId:t.storeId}:"NOT FOUND"),t},[a.salesData,n,D,a.user?.storeId]),$e=d.useMemo(()=>a.salesData.length===0||!f&&a.salesData.every(s=>s.date>n),[a.salesData,n,f]);d.useMemo(()=>{const s=new Date(n),t=s.getFullYear(),r=s.getMonth(),i=new Date(t,r+1,0).getDate();return s.getDate()===i},[n]);const Ps=d.useMemo(()=>new Date(n).getDate()===1,[n]),it=d.useMemo(()=>new Date(n).getDay()===5,[n]),us=d.useMemo(()=>{const s=new Date(n);s.setDate(s.getDate()-1);const t=s.toISOString().split("T")[0];return a.salesData.find(r=>r.date===t)},[a.salesData,n]),qe=d.useMemo(()=>{const s=a.inventory.filter(i=>{const x=i.date===n,u=o?i.storeId===o:!0;return x&&u}).reduce((i,x)=>i+x.totalCost,0),t=a.overheads.filter(i=>{const x=i.date===n,u=o?i.storeId===o:!0;return x&&u}).reduce((i,x)=>i+x.amount,0),r=a.fixedCosts.filter(i=>{const x=i.date===n,u=o?i.storeId===o:!0;return x&&u}).reduce((i,x)=>i+x.amount,0);return s+t+r},[a.inventory,a.overheads,a.fixedCosts,n,o]);d.useMemo(()=>a.fixedCosts.filter(s=>{const t=s.date===n,r=o?s.storeId===o:!0;return t&&r}).reduce((s,t)=>t.paymentMethod==="cash"?s+t.amount:t.paymentMethod==="both"&&t.cashAmount?s+t.cashAmount:s,0),[a.fixedCosts,n,o]);const As=d.useMemo(()=>a.fixedCosts.filter(s=>{const t=s.date===n,r=o?s.storeId===o:!0;return t&&r}).reduce((s,t)=>t.paymentMethod==="online"?s+t.amount:t.paymentMethod==="both"&&t.onlineAmount?s+t.onlineAmount:s,0),[a.fixedCosts,n,o]);d.useMemo(()=>a.overheads.filter(s=>{const t=s.date===n,r=o?s.storeId===o:!0;return t&&r}).reduce((s,t)=>t.paymentMethod==="cash"||!t.paymentMethod?s+t.amount:t.paymentMethod==="both"&&t.cashAmount?s+t.cashAmount:s,0),[a.overheads,n,o]);const Is=d.useMemo(()=>a.overheads.filter(s=>{const t=s.date===n,r=o?s.storeId===o:!0;return t&&r}).reduce((s,t)=>t.paymentMethod==="online"?s+t.amount:t.paymentMethod==="both"&&t.onlineAmount?s+t.onlineAmount:s,0),[a.overheads,n,o]),dt=(s,t,r,i,x)=>s+i+t-r-x,A=d.useMemo(()=>{const s=parseFloat(l.previousCashInHand)||0,t=parseFloat(l.cashAmount)||0,r=parseFloat(l.usedOnlineMoney)||0;return dt(s,t,qe,r,R)},[l.previousCashInHand,l.cashAmount,qe,l.usedOnlineMoney,R]),Z=d.useMemo(()=>{const s=parseFloat(l.actualCashInHand)||0;return s===0?0:s-A},[l.actualCashInHand,A]),De=Math.abs(Z)>500,F=d.useMemo(()=>{const s=new Date(n);s.setDate(s.getDate()-1);const t=s.toISOString().split("T")[0],r=o?a.salesData.find(c=>c.date===t&&c.storeId===o):a.salesData.find(c=>c.date===t);if(!r&&!a.onlineCashRecalibrations.find(j=>j.date===t&&j.storeId===o))return console.log("âš ï¸ No previous day data found. Starting from 0. Fill in previous day or create recalibration."),0;if(r&&r.actualPaytmBalance!==void 0&&r.actualPaytmBalance!==null){const c=r.actualPaytmBalance,j=parseFloat(l.paytmAmount)||0,Xe=parseFloat(l.onlineSales)||0,Rs=parseFloat(l.usedOnlineMoney)||0,Ls=R,Ts=c+j+Xe-Rs-Ls;return console.log("ğŸ“Š ONLINE CASH BALANCE (from previous day actual):",{effectiveStoreId:o,selectedDate:n,previousDate:t,startingBalance:c,todaysPaytm:j,todaysOnlinePayouts:Xe,todaysUsedOnlineMoney:Rs,todaysEmployeePayouts:Ls,finalBalance:Ts}),Ts}const i=n.slice(0,7),x=S&&S.month===i,u=o?a.salesData.filter(c=>c.storeId===o):a.salesData,p=o?a.inventory.filter(c=>c.storeId===o):a.inventory,B=o?a.overheads.filter(c=>c.storeId===o):a.overheads,I=o?a.fixedCosts.filter(c=>c.storeId===o):a.fixedCosts,N=x?S.date:"2000-01-01",g=x?S.actualBalance:0;console.log("ğŸ“Š ONLINE CASH BALANCE CALCULATION:",{effectiveStoreId:o,selectedDate:n,selectedMonth:i,hasRecalibration:x,recalibrationDate:x?S.date:"none",startingBalance:g,startDate:N,totalSalesRecords:a.salesData.length,filteredSalesRecords:u.length,totalInventoryRecords:a.inventory.length,filteredInventoryRecords:p.length});const b=u.filter(c=>c.date>=N&&c.date<n),m=b.reduce((c,j)=>c+(j.paytmAmount??0),0),y=parseFloat(l.paytmAmount)||0,V=m+y;console.log("ğŸ’° Paytm transactions included:",{count:b.length,historicalTransactions:b.map(c=>({date:c.date,amount:c.paytmAmount})),historicalTotal:m,todaysPaytm:y,totalIncludingToday:V});const Me=(o?H.filter(c=>c.storeId===o):H).filter(c=>c.date>=N&&c.date<n),Ge=Me.reduce((c,j)=>c+(j.swiggyPayout??0)+(j.zomatoPayout??0),0),Ze=parseFloat(l.onlineSales)||0,Oe=Ge+Ze;console.log("ğŸ’° Online payout transactions included:",{count:Me.length,historicalTransactions:Me.map(c=>({date:c.date,swiggy:c.swiggyPayout,zomato:c.zomatoPayout})),historicalTotal:Ge,todaysOnlinePayouts:Ze,totalIncludingToday:Oe});const fs=p.filter(c=>c.date>=N&&c.date<n).reduce((c,j)=>j.paymentMethod==="online"?c+j.totalCost:j.paymentMethod==="both"&&j.onlineAmount?c+j.onlineAmount:c,0),ns=B.filter(c=>c.date>=N&&c.date<n&&!X(c)).reduce((c,j)=>j.paymentMethod==="online"?c+j.amount:j.paymentMethod==="both"&&j.onlineAmount?c+j.onlineAmount:c,0),ks=I.filter(c=>c.date>=N&&c.date<n).reduce((c,j)=>j.paymentMethod==="online"?c+j.amount:j.paymentMethod==="both"&&j.onlineAmount?c+j.onlineAmount:c,0),Ee=B.filter(c=>X(c)&&c.date>=N&&c.date<n).reduce((c,j)=>{const Xe=j.paymentMethod||"online";return Xe==="online"?c+(j.amount||0):Xe==="both"?c+(j.onlineAmount||0):c},0),ls=fs+ns+ks,Ms=parseFloat(l.usedOnlineMoney)||0,Ve=ls+Ms,Ye=o?w.filter(c=>c.storeId===o):w,Ke=Ye.filter(c=>c.loanDate>=N&&c.loanDate<n).reduce((c,j)=>c+j.loanAmount,0),os=Ye.filter(c=>(c.loanDate<N||c.loanDate,c.repaidAmount>0&&c.loanDate<n)).reduce((c,j)=>j.loanDate>=N&&j.loanDate<n||j.loanDate<N?c+j.repaidAmount:c,0),Os=(o?Ce.filter(c=>!c.storeId||c.storeId===o):Ce).filter(c=>c.date>=N&&c.date<n).reduce((c,j)=>c+(j.amount||0),0)+R,Es=g+V+Oe+Ke-Ve-Ee-os-Os;return console.log("ğŸ“Š Balance breakdown:",{startingBalance:g,allPaytmReceived:V,allOnlinePayouts:Oe,loansReceived:Ke,allUsedOnlineMoney:Ve,allCommission:Ee,loanRepayments:os,allEmployeePayouts:Os,finalBalance:Es}),Es},[a.salesData,a.inventory,a.overheads,a.fixedCosts,H,w,Ce,R,n,o,S,l.paytmAmount,l.onlineSales,l.usedOnlineMoney]),ne=d.useMemo(()=>{const s=parseFloat(l.actualPaytmBalance)||0;return s===0?0:s-F},[l.actualPaytmBalance,F]),Ue=Math.abs(ne)>500,ze=d.useMemo(()=>{const s=n.slice(0,7),t=S&&S.month===s,r=t?S.date:"2000-01-01",i=`${s}-01`,x=o?a.salesData.filter(m=>m.storeId===o):a.salesData,u=o?a.fixedCosts.filter(m=>m.storeId===o):a.fixedCosts,p=o?a.overheads.filter(m=>m.storeId===o):a.overheads,B=o?a.inventory.filter(m=>m.storeId===o):a.inventory,I=new Set;x.filter(m=>m.date>=i&&m.date<=n).forEach(m=>I.add(m.date)),u.filter(m=>m.date>=i&&m.date<=n).forEach(m=>I.add(m.date)),p.filter(m=>m.date>=i&&m.date<=n).forEach(m=>I.add(m.date)),B.filter(m=>m.date>=i&&m.date<=n).forEach(m=>I.add(m.date)),p.filter(m=>X(m)&&m.date>=i&&m.date<=n).forEach(m=>I.add(m.date));const N=o?w.filter(m=>m.storeId===o):w;N.filter(m=>m.loanDate>=i&&m.loanDate<=n).forEach(m=>I.add(m.loanDate)),N.filter(m=>m.repaymentDate&&m.repaymentDate>=i&&m.repaymentDate<=n).forEach(m=>I.add(m.repaymentDate));const g=Array.from(I).sort();console.log("ğŸ“Š Daily Breakdown Calculation:",{hasRecalibration:t,recalibrationDate:r,displayStartDate:i,numberOfDays:g.length});const b=g.map(m=>{const y=x.find(h=>h.date===m),V=y?.paytmAmount??0,ys=y?.usedOnlineMoney??0,Me=u.filter(h=>h.date===m).reduce((h,P)=>{const pe=P.paymentMethod;return pe==="online"?h+P.amount:pe==="both"&&P.onlineAmount?h+P.onlineAmount:h},0),Ge=p.filter(h=>h.date===m&&!X(h)).reduce((h,P)=>{const pe=P.paymentMethod||(P.description?.includes("Commission")?"online":void 0);return pe==="online"?h+P.amount:pe==="both"&&P.onlineAmount?h+P.onlineAmount:h},0),Ze=B.filter(h=>h.date===m).reduce((h,P)=>P.paymentMethod==="online"?h+P.totalCost:P.paymentMethod==="both"&&P.onlineAmount?h+P.onlineAmount:h,0),Oe=p.filter(h=>X(h)&&h.date===m).reduce((h,P)=>{const pe=P.paymentMethod||"online";return pe==="online"?h+(P.amount||0):pe==="both"?h+(P.onlineAmount||0):h},0),fs=Ze+Ge+Me,ns=ys>0?ys:fs,Ee=(o?H.filter(h=>h.storeId===o):H).find(h=>h.date===m),ls=Ee?(Ee.swiggyPayout??0)+(Ee.zomatoPayout??0):0,Ve=(o?Ce.filter(h=>!h.storeId||h.storeId===o):Ce).filter(h=>h.date===m).reduce((h,P)=>h+(P.amount||0),0),Ye=N.filter(h=>h.loanDate===m).reduce((h,P)=>h+P.loanAmount,0),Ke=N.filter(h=>h.repaymentDate===m&&h.repaidAmount>0).reduce((h,P)=>h+P.repaidAmount,0),os=V+ls+Ye-ns-Oe-Ve-Ke;return{date:m,paytmReceived:V,onlinePayouts:ls,usedOnlineMoney:ns,commission:Oe,employeePayouts:Ve,loansTaken:Ye,loanRepayments:Ke,inventoryCosts:Ze,fixedCosts:Me,overheadCosts:Ge,netChange:os,runningBalance:0}});if(console.log("ğŸ’° ===== CALCULATING RUNNING BALANCES ====="),console.log("ğŸ“Š Has recalibration this month?",t),console.log("ğŸ“… Recalibration date:",r),console.log("ğŸ“Š Number of daily data entries:",b.length),console.log("ğŸ“Š Daily data dates:",b.map(m=>m.date)),t){const m=b.findIndex(y=>y.date===r);if(console.log("ğŸ” Recalibration index in daily data:",m),console.log("ğŸ’° Recalibration actual balance:",S.actualBalance),m>=0){b[m].runningBalance=S.actualBalance,console.log(`âœ… Set ${r} balance to â‚¹${S.actualBalance}`),console.log("â¡ï¸ Calculating FORWARD from recalibration date...");for(let y=m+1;y<b.length;y++)b[y].runningBalance=b[y-1].runningBalance+b[y].netChange,console.log(`  ${b[y].date}: prev(${b[y-1].runningBalance.toFixed(2)}) + net(${b[y].netChange.toFixed(2)}) = ${b[y].runningBalance.toFixed(2)}`);console.log("â¬…ï¸ Calculating BACKWARD from recalibration date...");for(let y=m-1;y>=0;y--)b[y].runningBalance=b[y+1].runningBalance-b[y+1].netChange,console.log(`  ${b[y].date}: next(${b[y+1].runningBalance.toFixed(2)}) - nextNet(${b[y+1].netChange.toFixed(2)}) = ${b[y].runningBalance.toFixed(2)}`);console.log("âœ… Final balances for all dates:"),b.forEach(y=>{console.log(`  ${y.date}: â‚¹${y.runningBalance.toFixed(2)} (net change: â‚¹${y.netChange.toFixed(2)})`)})}else{console.log("âš ï¸ Recalibration date not found in daily data range!"),console.log("âš ï¸ Starting from zero...");let y=0;b.forEach(V=>{y+=V.netChange,V.runningBalance=y,console.log(`  ${V.date}: â‚¹${y.toFixed(2)}`)})}}else{console.log("ğŸ“Š No recalibration - calculating normally from zero");let m=0;b.forEach(y=>{m+=y.netChange,y.runningBalance=m,console.log(`  ${y.date}: â‚¹${m.toFixed(2)}`)})}return console.log(`ğŸ’° ===== END RUNNING BALANCE CALCULATION =====
`),b},[a.salesData,a.fixedCosts,a.overheads,a.inventory,H,Ce,w,n,o,S]),Fe=d.useMemo(()=>{const s=a.inventory.filter(t=>t.date===n).reduce((t,r)=>r.paymentMethod==="online"?t+r.totalCost:r.paymentMethod==="both"&&r.onlineAmount?t+r.onlineAmount:t,0);return console.log(`ğŸ’° Inventory Online Total for ${n}:`,s,"items:",a.inventory.filter(t=>t.date===n).map(t=>({name:t.itemName,payment:t.paymentMethod,total:t.totalCost}))),s},[a.inventory,n]),Pe=d.useMemo(()=>{const s=a.overheads.filter(u=>u.date===n),t=n.substring(0,7),r=a.overheads.filter(u=>u.category==="service_charge"&&u.date?.startsWith(t));console.log(`ğŸ” [OH] Month: ${t}, Service charges:`,r.length,r.map(u=>({desc:u.description,amt:u.amount,payment:u.paymentMethod})));const i=a.overheads.filter(u=>(u.category==="service_charge"&&u.description?.includes("Aggregator Commission")||u.category==="commission")&&u.date?.startsWith(t));console.log("ğŸ” [OH] Commission entries found:",i.length,i.map(u=>({category:u.category,desc:u.description,amt:u.amount,payment:u.paymentMethod})));let x=s.reduce((u,p)=>{if(p.category==="commission"||p.category==="service_charge"&&p.description?.includes("Aggregator Commission"))return console.log("â­ï¸ [OH] Skipping commission in daily loop:",{category:p.category,desc:p.description,amount:p.amount}),u;const I=p.paymentMethod||void 0;return I==="online"?u+p.amount:I==="both"&&p.onlineAmount?u+p.onlineAmount:u},0);if(i.length>0){const u=new Date(n),p=u.getFullYear(),B=u.getMonth(),I=new Date(p,B+1,0).getDate(),N=u.getDate();if(N===I){const b=i.reduce((m,y)=>{const V=y.paymentMethod||"online";return V==="online"?m+y.amount:V==="both"&&y.onlineAmount?m+y.onlineAmount:m},0);console.log(`ğŸ’° [OH] Adding FULL monthly commission (last day of month): â‚¹${b.toFixed(2)} (entries: ${i.length})`),x+=b}else console.log(`â­ï¸ [OH] Skipping commission (not last day): Day ${N}/${I}`)}return console.log(`ğŸ’° Overhead Online Total for ${n}:`,x,"items:",s.map(u=>({category:u.category,payment:u.paymentMethod,total:u.amount})),"commissions:",i.map(u=>({amount:u.amount,payment:u.paymentMethod,category:u.category}))),x},[a.overheads,n]),Ae=d.useMemo(()=>{const s=a.fixedCosts.filter(t=>t.date===n).reduce((t,r)=>r.paymentMethod==="online"?t+r.amount:r.paymentMethod==="both"&&r.onlineAmount?t+r.onlineAmount:t,0);return console.log(`ğŸ’° Fixed Cost Online Total for ${n}:`,s,"items:",a.fixedCosts.filter(t=>t.date===n).map(t=>({category:t.category,payment:t.paymentMethod,total:t.amount}))),s},[a.fixedCosts,n]),Ie=d.useMemo(()=>{const s=Fe+Pe+Ae+R;return console.log(`ğŸ’³ TOTAL Online Expenses for ${n}:`,{inventory:Fe,overhead:Pe,fixedCost:Ae,contractPayouts:R,note:"Contract payouts ARE included in Amount Used from Paytm",total:s}),s},[Fe,Pe,Ae,R,n]),We=d.useMemo(()=>({inventory:Fe,overhead:Pe,fixedCost:Ae,total:Ie}),[Fe,Pe,Ae,Ie]);d.useEffect(()=>{if(f)U({offlineSales:(f.offlineSales??0).toString(),paytmAmount:(f.paytmAmount??0).toString(),cashAmount:(f.cashAmount??0).toString(),employeeSalary:(f.employeeSalary??0).toString(),previousCashInHand:(f.previousCashInHand??0).toString(),usedOnlineMoney:Ie.toString(),actualCashInHand:(f.actualCashInHand??0).toString(),actualPaytmBalance:(f.actualPaytmBalance??0).toString()}),te(!0),W(f.id);else{let s=0;us&&(s=us.actualCashInHand??0),U({offlineSales:"",paytmAmount:"",cashAmount:"",employeeSalary:"0",previousCashInHand:s.toString(),usedOnlineMoney:Ie.toString(),actualCashInHand:"",actualPaytmBalance:""}),te(!1),W(null)}},[n,f,us,Ie]);const ct=async s=>{s.preventDefault(),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ”µ SAVE BUTTON CLICKED - Starting validation checks"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ“Š Form Data:",l),console.log("ğŸ’° Financial Values:",{offlineSales:parseFloat(l.offlineSales)||0,paytmAmount:parseFloat(l.paytmAmount)||0,cashAmount:parseFloat(l.cashAmount)||0,previousCashInHand:parseFloat(l.previousCashInHand)||0,usedOnlineMoney:parseFloat(l.usedOnlineMoney)||0,actualCashInHand:parseFloat(l.actualCashInHand)||0,actualPaytmBalance:parseFloat(l.actualPaytmBalance)||0,expectedCashInHand:A,cashDiscrepancy:(parseFloat(l.actualCashInHand)||0)-A,expectedPaytmBalance:F,paytmDiscrepancy:ne,onlineCashBalance:F,totalContractPayout:R,totalExpenses:qe,totalCombinedCash:A+F}),console.log("ğŸš¦ Validation Flags:",{paymentMismatch:_e,isSubmitting:C,canEditSales:re,isOperationsManager:Se,isClusterHead:fe,needsApproval:De,needsPaytmApproval:Ue,hasPermission:re||Se||fe}),console.log("ğŸª Store Context:",{selectedStoreId:D,effectiveStoreId:o,userStoreId:a.user?.storeId,userRole:a.user?.role}),console.log("ğŸ‘¤ User Info:",{userId:a.user?.id,userEmail:a.user?.email,employeeId:a.user?.employeeId,role:a.user?.role});const t=l.offlineSales&&l.actualCashInHand&&l.actualPaytmBalance;if(console.log("ğŸ“ Form Completeness:",{hasOfflineSales:!!l.offlineSales,hasActualCash:!!l.actualCashInHand,hasActualPaytm:!!l.actualPaytmBalance,isComplete:t}),C){console.log("âš ï¸âš ï¸âš ï¸ BLOCKED: Submission already in progress");return}if(!re&&!Se&&!fe){console.log("âš ï¸âš ï¸âš ï¸ BLOCKED: User does not have permission to save sales data"),alert("You do not have permission to save sales data.");return}F<0&&(console.log("âš ï¸ WARNING: Online Cash (Paytm) is NEGATIVE:",F),console.log("ğŸ’¡ This might indicate insufficient funds in Paytm account"));const r=A+F;r<0&&(console.log("âš ï¸ WARNING: Total Combined Cash is NEGATIVE:",r),console.log("ğŸ’¡ This indicates business is running at a loss or data entry issues")),console.log("âœ… All validation checks passed - Showing confirmation dialog..."),ge(s),E(!0),ae(!1)},xs=()=>{E(!1),ae(!1),ge(null)},mt=async()=>{if(console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸŸ¢ CONFIRMATION DIALOG - Submit Confirmed"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("âœ… Confirmation checkbox checked:",k),!k){console.log("âš ï¸âš ï¸âš ï¸ BLOCKED: Confirmation checkbox not checked"),alert("âš ï¸ Please confirm that you take responsibility for this sales data.");return}console.log("ğŸ”’ Closing dialog and setting submitting state..."),E(!1),_(!0);const s=parseFloat(l.actualCashInHand)||0,t=s-A,r=parseFloat(l.actualPaytmBalance)||0,i=r-F;console.log("ğŸ’° Cash calculation:",{actualCash:s,expectedCashInHand:A,offset:t,actualPaytm:r,expectedPaytmBalance:F,paytmOffset:i,formData:l});const x=Se,u={date:n,offlineSales:parseFloat(l.offlineSales)||0,paytmAmount:parseFloat(l.paytmAmount)||0,cashAmount:parseFloat(l.cashAmount)||0,onlineSales:0,onlineSalesCommission:0,employeeSalary:R,previousCashInHand:parseFloat(l.previousCashInHand)||0,usedOnlineMoney:parseFloat(l.usedOnlineMoney)||0,actualCashInHand:s,cashOffset:t,actualPaytmBalance:r,paytmOffset:i,salesDiscrepancy:f?.salesDiscrepancy!==void 0?f.salesDiscrepancy:t,approvalRequired:De||Ue,approvalStatus:x?"pending":"approved",createdBy:a.user?.employeeId||a.user?.email||"unknown",approvedBy:x?f?.approvedBy||null:a.user?.employeeId||a.user?.email||"self",approvedAt:x?f?.approvedAt||null:new Date().toISOString(),approvalRequested:f?.approvalRequested||!1,approvalRequestedAt:f?.approvalRequestedAt||null,requestedCashInHand:f?.requestedCashInHand||null,requestedOffset:f?.requestedOffset||null,rejectedBy:f?.rejectedBy||null,rejectedAt:f?.rejectedAt||null,rejectionReason:f?.rejectionReason||null,storeId:D||a.user?.storeId||void 0};console.log("ğŸ“¤ Saving sales data:",u);try{if(console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ’¾ STARTING SAVE PROCESS"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ”„ Step 1: Calling save API..."),console.log("ğŸ“‹ Sales data to save:",u),se&&$?(console.log("ğŸ“ Mode: UPDATING existing sales data"),console.log("ğŸ†” Editing ID:",$),console.log("â±ï¸ Calling context.updateSalesData..."),await a.updateSalesData($,u),console.log("âœ… Update successful")):(console.log("â• Mode: ADDING new sales data"),console.log("â±ï¸ Calling context.addSalesData..."),await a.addSalesData(u),console.log("âœ… Add successful")),console.log("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),console.log("ğŸ”„ Step 2: Syncing contract worker payouts..."),console.log("ğŸ‘· Contract payouts count:",Q.length),console.log("ğŸ‘· Contract payouts:",Q),Q.length>0){console.log("â±ï¸ Fetching all payouts to check for duplicates...");const p=await is();console.log("ğŸ“¦ Total payouts in system:",p.length);const B=xe.map(g=>g.id);console.log("ğŸ‘¤ Contract worker IDs:",B);const I=p.filter(g=>g.date===n&&B.includes(g.employeeId));console.log("ğŸ—‘ï¸ Existing payouts for this date:",I.length,I),console.log("â±ï¸ Deleting old payouts...");for(const g of I)console.log("ğŸ—‘ï¸ Deleting payout:",g.id,g),await qs(g.id),console.log("âœ… Deleted old payout:",g.id);console.log("â±ï¸ Preparing new payouts to save...");const N=Q.filter(g=>g.employeeId&&g.amount).map(g=>{const b=xe.find(m=>m.id===g.employeeId);return{id:crypto.randomUUID(),employeeId:g.employeeId,employeeName:b?.name||"",amount:parseFloat(g.amount),date:n,storeId:o,createdAt:new Date().toISOString()}});console.log("ğŸ’¾ Payouts to save:",N.length,N),N.length>0?(console.log("â±ï¿½ï¿½ï¿½ Saving payouts to API..."),await Pt(N),console.log("âœ… Contract worker payouts synced to payroll:",N)):console.log("â­ï¸ No valid payouts to save")}else{console.log("â­ï¸ No contract payouts entered, checking for old ones to delete...");const p=await is();console.log("ğŸ“¦ Total payouts in system:",p.length);const B=xe.map(N=>N.id),I=p.filter(N=>N.date===n&&B.includes(N.employeeId));console.log("ğŸ—‘ï¸ Existing payouts for this date to delete:",I.length);for(const N of I)console.log("ğŸ—‘ï¸ Deleting payout:",N.id),await qs(N.id),console.log("âœ… Deleted payout (no workers entered):",N.id)}console.log("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"),console.log("ğŸ”„ Step 3: Reloading employee payouts..."),await Cs(),console.log("âœ… Employee payouts reloaded"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ‰ ALL SAVES COMPLETED SUCCESSFULLY!"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),alert("Sales data and contract worker payouts saved successfully!")}catch(p){console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("âŒ ERROR DURING SAVE PROCESS"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.error("ğŸ’¥ Error details:",p),console.error("ğŸ’¥ Error stack:",p instanceof Error?p.stack:"No stack trace"),console.error("ğŸ’¥ Error message:",p instanceof Error?p.message:String(p)),alert("Failed to save sales data. Please try again.")}finally{console.log("ğŸ”“ Resetting isSubmitting to false"),_(!1)}},ut=async()=>{if(!$)return;const s=parseFloat(l.actualCashInHand)||0,t=s-A;if(parseFloat(l.actualPaytmBalance),!!confirm(`Request approval for cash discrepancy of â‚¹${Math.abs(t).toFixed(2)}?

This will notify the cluster head for approval.`))try{await a.requestSalesApproval($,s,t),alert("Approval request sent successfully!")}catch{alert("Failed to request approval. Please try again.")}},xt=async s=>{if(confirm("Approve this discrepancy? The new cash amount will be accepted."))try{await a.approveDiscrepancy(s),alert("Discrepancy approved successfully!")}catch{alert("Failed to approve discrepancy. Please try again.")}},pt=async s=>{const t=prompt("Please enter reason for rejection:");if(t)try{await a.rejectDiscrepancy(s,t),alert("Discrepancy rejected. Manager must pay the difference.")}catch{alert("Failed to reject discrepancy. Please try again.")}},ht=async()=>{const s=parseFloat(J);if(!s||s<=0){alert("Please enter a valid amount to convert");return}const t=A;if(s>t){alert(`Cannot convert more than â‚¹${t.toFixed(2)} (your current expected cash in hand)`);return}if(confirm(`Convert â‚¹${s.toFixed(2)} from Offline Cash to Online Cash (Paytm)?

Expected Cash: â‚¹${A.toFixed(2)} â†’ â‚¹${(A-s).toFixed(2)}
Online Cash: â‚¹${F.toFixed(2)} â†’ â‚¹${(F+s).toFixed(2)}`)){M(!0);try{await Ft(a.user.accessToken,o,n,s,a.user?.name||a.user?.email||"Unknown User"),await a.loadSalesData(),G(!1),ye(""),alert("Cash converted successfully!")}catch(r){console.error("Error converting cash:",r),alert(r.message||"Failed to convert cash. Please try again.")}finally{M(!1)}}},rs=d.useMemo(()=>{const t=(o?K.filter(r=>r.storeId===o):K).find(r=>r.date===n);return t?(t.swiggySales||0)+(t.zomatoSales||0):0},[K,n,o]),ke=parseFloat(l.offlineSales)||0,ps=parseFloat(l.paytmAmount)||0,hs=parseFloat(l.cashAmount)||0,gs=ps+hs,_e=Math.abs(ke-gs)>.01;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-purple-50/30 to-pink-50/30",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(Ct,{selectedDate:n,onDateChange:Y}),e.jsxs("div",{className:"flex gap-3 mb-6 mt-4 bg-white/50 backdrop-blur-sm p-1.5 rounded-2xl border border-purple-200/50",children:[e.jsxs("button",{onClick:()=>z("offline"),className:`flex-1 py-3 px-6 rounded-xl font-semibold transition-all text-sm ${L==="offline"?"bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-md":"text-gray-600 hover:bg-white/80"}`,children:[e.jsx(zs,{className:"inline-block w-4 h-4 mr-2"}),"Offline Sales"]}),e.jsxs("button",{onClick:()=>z("online"),className:`flex-1 py-3 px-6 rounded-xl font-semibold transition-all text-sm ${L==="online"?"bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-md":"text-gray-600 hover:bg-white/80"}`,children:[e.jsx(cs,{className:"inline-block w-4 h-4 mr-2"}),"Online Sales (Swiggy/Zomato)"]})]}),L==="online"&&e.jsx(Lt,{context:a,selectedStoreId:D,selectedDate:n,onDateChange:Y,onDataUpdate:Ds}),L==="offline"&&e.jsxs(e.Fragment,{children:[it&&a.isManager&&e.jsxs("div",{className:"mt-6 bg-gradient-to-br from-blue-50/80 to-blue-100/50 backdrop-blur-sm border border-blue-300/50 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(be,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h2",{className:"text-sm font-semibold text-gray-900",children:"Weekly Cash Reporting - Friday"})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-3",children:"Today is Friday! Please report the actual cash left with you after entering today's sales data."}),e.jsx("div",{className:"bg-blue-50/70 border border-blue-200/50 rounded-xl p-3 text-xs",children:e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Important:"})," If the cash discrepancy exceeds â‚¹500, cluster head approval will be required before saving."]})})]}),fe&&e.jsxs("div",{className:"mt-6 space-y-4",children:[a.salesData.filter(s=>s.approvalRequested&&!s.approvedBy&&!s.rejectedBy).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-orange-50/80 to-orange-100/50 backdrop-blur-sm border border-orange-300/50 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-500/10 rounded-lg",children:e.jsx(be,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h2",{className:"text-sm font-semibold text-gray-900",children:"Discrepancy Approval Requests"})]}),e.jsx("div",{className:"space-y-3",children:a.salesData.filter(s=>s.approvalRequested&&!s.approvedBy&&!s.rejectedBy).map(s=>e.jsxs("div",{className:"bg-white/80 rounded-xl p-4 border border-orange-300/50 shadow-sm",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:Je(s.date)}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Expected Cash: â‚¹",(s.actualCashInHand-s.cashOffset).toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Actual Cash: â‚¹",s.requestedCashInHand?.toFixed(2)]}),e.jsxs("p",{className:"text-xs font-semibold text-orange-600 mt-1",children:["Discrepancy: â‚¹",((s.requestedCashInHand||0)-(s.actualCashInHand-s.cashOffset)).toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>xt(s.id),className:"flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl font-semibold transition-all text-sm shadow-sm",children:"âœ“ Approve"}),e.jsx("button",{onClick:()=>pt(s.id),className:"flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-xl font-semibold transition-all text-sm shadow-sm",children:"âœ— Reject"})]})]},s.id))})]}),a.salesData.filter(s=>s.approvalRequired&&!s.approvedBy&&!s.approvalRequested).length>0&&e.jsxs("div",{className:"bg-[#FFF4E6] border-2 border-[#FFE4C4] rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(be,{className:"w-6 h-6 text-[#E8A87C]"}),e.jsx("h2",{className:"text-gray-900",children:"Pending Approvals"})]}),e.jsx("div",{className:"space-y-3",children:a.salesData.filter(s=>s.approvalRequired&&!s.approvedBy&&!s.approvalRequested).map(s=>e.jsxs("div",{className:"bg-white rounded-lg p-4 flex items-center justify-between border border-yellow-300",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900",children:Je(s.date)}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Cash Discrepancy: ",e.jsxs("span",{className:s.cashOffset>0?"text-green-600":"text-red-600",children:[s.cashOffset>0?"+":"","â‚¹",s.cashOffset.toFixed(2)]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Expected: â‚¹",(s.actualCashInHand-s.cashOffset).toFixed(2)," | Actual: â‚¹",s.actualCashInHand.toFixed(2)]})]}),e.jsx("button",{onClick:async()=>{try{await a.approveSalesData(s.id),alert("Approved successfully!")}catch{alert("Failed to approve. Please try again.")}},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-all",children:"âœ“ Approve"})]},s.id))})]})]}),f&&f.approvedBy&&e.jsxs("div",{className:"mt-6 bg-gradient-to-br from-green-50/80 to-green-100/50 backdrop-blur-sm border border-green-300/50 rounded-2xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:e.jsx(Ns,{className:"w-5 h-5 text-green-600"})}),e.jsx("h2",{className:"text-sm font-semibold text-gray-900",children:"Sales Approved"})]}),e.jsxs("p",{className:"text-sm text-gray-700",children:["âœ“ Your sales entry for ",Je(f.date)," has been approved by ",f.approvedBy,"."]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5 mt-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:e.jsx(Ne,{className:"w-5 h-5 text-green-600"})}),e.jsx("h2",{className:"text-base font-semibold text-gray-800",children:"Sales Entry"})]}),e.jsxs("form",{onSubmit:ct,className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50/80 to-blue-100/50 backdrop-blur-sm rounded-2xl p-5 border border-blue-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(zs,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Offline Sales"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Total Offline Sales (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:l.offlineSales,onChange:s=>U({...l,offlineSales:s.target.value}),className:"w-full px-4 py-3 border border-blue-200 bg-white/70 rounded-xl text-lg font-semibold focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all",required:!0,disabled:!re,placeholder:"Enter total offline sales"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50/80 to-orange-100/50 backdrop-blur-sm rounded-2xl p-5 border border-orange-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-500/10 rounded-lg",children:e.jsx(Bs,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Payment Mode Distribution"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"bg-white/70 p-3 rounded-xl border border-orange-200/50",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Paytm (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:l.paytmAmount,onChange:s=>U({...l,paytmAmount:s.target.value}),className:"w-full px-2 py-1 border-0 bg-transparent text-base font-semibold focus:ring-0 focus:outline-none",required:!0,disabled:!re,placeholder:"Enter Paytm amount"})]}),e.jsxs("div",{className:"bg-white/70 p-3 rounded-xl border border-orange-200/50",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Cash (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:l.cashAmount,onChange:s=>U({...l,cashAmount:s.target.value}),className:"w-full px-2 py-1 border-0 bg-transparent text-base font-semibold focus:ring-0 focus:outline-none",required:!0,disabled:!re,placeholder:"Enter cash amount"})]})]}),_e&&e.jsxs("div",{className:"bg-red-100/80 border border-red-300/50 text-red-700 px-3 py-2 rounded-xl text-xs flex items-center gap-2",children:[e.jsx(be,{className:"w-3.5 h-3.5"}),"Payment mode total (â‚¹",gs.toFixed(2),") doesn't match offline sales (â‚¹",ke.toFixed(2),")"]}),!_e&&ke>0&&e.jsxs("div",{className:"bg-green-100/80 border border-green-300/50 text-green-700 px-3 py-2 rounded-xl text-xs flex items-center gap-2",children:[e.jsx(Ns,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs",children:"âœ“ Payment modes match total sales"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50/80 to-purple-100/50 backdrop-blur-sm rounded-2xl p-5 border border-purple-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg",children:e.jsx(Dt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Contract Worker Payouts"})]}),a.isManager&&e.jsxs("button",{type:"button",onClick:lt,className:"flex items-center gap-1 px-3 py-1.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-xs font-medium shadow-sm",children:[e.jsx(Hs,{className:"w-3.5 h-3.5"}),"Add Worker"]})]}),e.jsx("div",{className:"bg-blue-50/70 border border-blue-200/50 rounded-xl p-3 mb-3 text-xs text-blue-800",children:e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:["ğŸ’¡ Employee payouts are deducted from ",e.jsx("strong",{children:"Online Cash in Hand (Paytm)"}),", not from Expected Cash."]})]})}),et?e.jsx("p",{className:"text-sm text-gray-500",children:"Loading workers..."}):xe.length===0?e.jsx("div",{className:"bg-yellow-50/70 border border-yellow-200/50 rounded-xl p-3 text-xs text-gray-700",children:e.jsx("p",{children:"No contract workers found. Please add contract workers in the Payroll tab first."})}):e.jsxs("div",{className:"space-y-2.5",children:[Q.length===0?e.jsx("div",{className:"bg-white/70 border border-gray-200/50 rounded-xl p-3 text-xs text-gray-600",children:'No payouts entered for today. Click "Add Worker" to record a payout.'}):Q.map((s,t)=>{const r=xe.find(i=>i.id===s.employeeId);return e.jsx("div",{className:"bg-white/70 border border-purple-200/50 rounded-xl p-3 space-y-2",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Select Worker"}),e.jsxs("select",{value:s.employeeId,onChange:i=>Fs(t,"employeeId",i.target.value),className:"w-full px-3 py-2 border border-purple-200 bg-white rounded-lg text-sm focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all",disabled:!a.isManager,required:!0,children:[e.jsx("option",{value:"",children:"Choose a worker..."}),xe.map(i=>e.jsxs("option",{value:i.id,children:[i.name," (",i.employeeId,")"]},i.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Amount Paid (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:s.amount,onChange:i=>Fs(t,"amount",i.target.value),className:"w-full px-3 py-2 border border-purple-200 bg-white rounded-lg text-sm focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all",placeholder:r?.dailyRate?`Suggested: â‚¹${r.dailyRate}`:"Enter amount",disabled:!a.isManager,required:!0}),r?.dailyRate&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Daily rate: â‚¹",r.dailyRate]})]})]}),a.isManager&&e.jsx("button",{type:"button",onClick:()=>ot(t),className:"p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors mt-5",children:e.jsx(ds,{className:"w-4 h-4"})})]})},t)}),Q.length>0&&e.jsxs("div",{className:"bg-purple-600 text-white rounded-xl p-3 flex justify-between items-center shadow-sm",children:[e.jsx("span",{className:"text-xs font-medium",children:"Total Contract Payouts:"}),e.jsxs("span",{className:"text-lg font-bold",children:["â‚¹",R.toFixed(2)]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3 bg-purple-50/70 p-2 rounded-xl border border-purple-200/50",children:["ğŸ’¡ ",e.jsx("strong",{children:"Note:"})," Payouts entered here will automatically sync with the Payroll page. For permanent employees, use the Payroll tab."]}),R>0&&e.jsxs("p",{className:"text-xs text-purple-700 mt-2 bg-purple-100/70 p-2 rounded-xl border border-purple-300/50 flex items-center gap-1",children:["ğŸ’° ",e.jsx("strong",{children:"Cash Impact:"})," â‚¹",R.toFixed(2)," will be deducted from Online Cash in Hand (Paytm)."]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-cyan-50/80 to-cyan-100/50 backdrop-blur-sm rounded-2xl p-5 border border-cyan-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-cyan-500/10 rounded-lg",children:e.jsx(kt,{className:"w-5 h-5 text-cyan-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Used Online Money"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:["Amount Used from Paytm (â‚¹)",Ie>0&&e.jsxs("span",{className:"ml-2 text-xs bg-blue-100/70 text-blue-800 px-2 py-0.5 rounded-full border border-blue-200/50",children:["Auto: â‚¹",Fe.toFixed(2),"(Inv) + â‚¹",Pe.toFixed(2),"(OH) + â‚¹",Ae.toFixed(2),"(FC) + â‚¹",R.toFixed(2),"(CP)"]})]}),e.jsx("input",{type:"number",step:"0.01",value:l.usedOnlineMoney,onChange:s=>U({...l,usedOnlineMoney:s.target.value}),className:"w-full px-4 py-3 border border-cyan-200 bg-white/70 rounded-xl text-lg font-semibold focus:ring-2 focus:ring-cyan-400 focus:border-transparent transition-all",required:!0,disabled:!re})]})]}),($e||Ps)&&e.jsxs("div",{className:"bg-gradient-to-br from-amber-50/80 to-amber-100/50 backdrop-blur-sm rounded-2xl p-5 border border-amber-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:e.jsx(je,{className:"w-5 h-5 text-amber-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:$e?"Opening Cash Balance (Day 1)":"Cash Left from Previous Month"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Cash Left (â‚¹)"}),e.jsx("input",{type:"number",step:"0.01",value:l.previousCashInHand,onChange:s=>U({...l,previousCashInHand:s.target.value}),className:"w-full px-4 py-3 border border-amber-200 bg-white/70 rounded-xl text-lg font-semibold focus:ring-2 focus:ring-amber-400 focus:border-transparent transition-all",disabled:!re,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:$e?"Enter starting cash for the first day":"Enter cash left from previous month (after deducting all expenses and salaries)"})]})]}),!$e&&!Ps&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50/80 to-gray-100/50 backdrop-blur-sm rounded-2xl p-5 border border-gray-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"p-2 bg-gray-500/10 rounded-lg",children:e.jsx(je,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h3",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Offline Cash Left from Previous Day"})]}),e.jsxs("div",{className:"bg-white/70 rounded-xl p-4 border border-gray-200/50",children:[e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["â‚¹",(parseFloat(l.previousCashInHand)||0).toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 flex items-start gap-1",children:[e.jsx("span",{className:"text-yellow-500",children:"ğŸ’¡"}),e.jsx("span",{children:"Auto-calculated from previous day's offline cash left after deducting expenses (not including employee payouts)."})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50/80 to-pink-100/50 backdrop-blur-sm rounded-2xl p-5 border border-purple-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg",children:e.jsx(je,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-xs font-semibold text-purple-700 uppercase tracking-wide",children:"Online Cash (Paytm) Left from Previous Day"})]}),e.jsxs("div",{className:"bg-white/70 rounded-xl p-4 border border-purple-200/50",children:[e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["â‚¹",(()=>{const s=new Date(n);s.setDate(s.getDate()-1);const t=s.toISOString().split("T")[0],r=o?a.salesData.find(g=>g.date===t&&g.storeId===o):a.salesData.find(g=>g.date===t);if(r&&r.actualPaytmBalance!==void 0&&r.actualPaytmBalance!==null)return r.actualPaytmBalance.toFixed(2);if(!r&&!a.onlineCashRecalibrations.find(b=>b.date===t&&b.storeId===o))return"0.00";const i=a.onlineCashRecalibrations.filter(g=>g.storeId===o&&g.date<n).sort((g,b)=>b.date.localeCompare(g.date))[0];if(!i)return"0.00";const x=i.date,u=a.salesData.filter(g=>(o?g.storeId===o:!0)&&g.date>x&&g.date<n),p=u.reduce((g,b)=>g+(b.paytmAmount||0),0),B=u.reduce((g,b)=>g+(b.onlineSales||0),0),I=u.reduce((g,b)=>g+(b.usedOnlineMoney||0),0),N=u.reduce((g,b)=>g+(b.contractPayouts?.reduce((m,y)=>m+y.amount,0)||0),0);return(i.balance+p+B-I-N).toFixed(2)})()]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 flex items-start gap-1",children:[e.jsx("span",{className:"text-yellow-500",children:"ğŸ’¡"}),e.jsx("span",{children:"Auto-calculated from previous day's Paytm balance after accounting for online sales, expenses, and payouts."})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50/80 to-teal-100/50 backdrop-blur-sm rounded-2xl p-5 border border-teal-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-teal-500/10 rounded-lg",children:e.jsx(je,{className:"w-5 h-5 text-teal-600"})}),e.jsx("h3",{className:"text-xs font-semibold text-teal-700 uppercase tracking-wide",children:"Cash Status"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-2",children:"Expected Cash"}),e.jsxs("div",{className:"bg-white/70 rounded-xl p-4 border border-teal-200/50",children:[e.jsxs("p",{className:"text-4xl font-bold text-gray-900",children:["â‚¹",A.toFixed(2)]}),e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-xs text-blue-600 cursor-pointer hover:underline flex items-center gap-1",children:"â–¸ View expense breakdown (all expenses incl. commission)"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border border-teal-200",children:[e.jsx("p",{className:"font-semibold text-teal-700 mb-1",children:"Inventory Cost:"}),e.jsxs("p",{className:"ml-2",children:["â‚¹",(a.inventory.filter(t=>{const r=t.date===n,i=o?t.storeId===o:!0;return r&&i}).reduce((t,r)=>r.paymentMethod==="cash"||!r.paymentMethod?t+r.totalCost:r.paymentMethod==="both"&&r.cashAmount?t+r.cashAmount:t,0)+We.inventory).toFixed(2)," (cash: â‚¹",a.inventory.filter(t=>{const r=t.date===n,i=o?t.storeId===o:!0;return r&&i}).reduce((t,r)=>r.paymentMethod==="cash"||!r.paymentMethod?t+r.totalCost:r.paymentMethod==="both"&&r.cashAmount?t+r.cashAmount:t,0).toFixed(2),", online: â‚¹",We.inventory.toFixed(2),")"]}),e.jsx("p",{className:"font-semibold text-teal-700 mt-2 mb-1",children:"Overhead Cost:"}),e.jsxs("p",{className:"ml-2",children:["â‚¹",(a.overheads.filter(t=>{const r=t.date===n,i=o?t.storeId===o:!0;return r&&i}).reduce((t,r)=>r.paymentMethod==="cash"||!r.paymentMethod?t+r.amount:r.paymentMethod==="both"&&r.cashAmount?t+r.cashAmount:t,0)+We.overhead).toFixed(2)," (cash: â‚¹",a.overheads.filter(t=>{const r=t.date===n,i=o?t.storeId===o:!0;return r&&i}).reduce((t,r)=>r.paymentMethod==="cash"||!r.paymentMethod?t+r.amount:r.paymentMethod==="both"&&r.cashAmount?t+r.cashAmount:t,0).toFixed(2),", online: â‚¹",We.overhead.toFixed(2),")"]}),e.jsx("p",{className:"font-semibold text-teal-700 mt-2 mb-1",children:"Fixed Costs:"}),e.jsxs("p",{className:"ml-2",children:["â‚¹",(a.fixedCosts.filter(t=>{const r=t.date===n,i=o?t.storeId===o:!0;return r&&i}).reduce((t,r)=>r.paymentMethod==="cash"||!r.paymentMethod?t+r.amount:r.paymentMethod==="both"&&r.cashAmount?t+r.cashAmount:t,0)+We.fixedCost).toFixed(2)," (cash + online)"]}),e.jsx("p",{className:"font-semibold text-teal-700 mt-2 mb-1",children:"Total Expenses:"}),e.jsxs("p",{className:"ml-2 font-medium",children:["â‚¹",qe.toFixed(2)]})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:["Actual Cash in Hand (â‚¹) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",value:l.actualCashInHand,onChange:s=>U({...l,actualCashInHand:s.target.value}),className:"w-full px-4 py-3 border border-teal-300 rounded-xl bg-white/70 text-lg font-semibold focus:ring-2 focus:ring-teal-400 focus:border-transparent transition-all",required:!0,disabled:!re,placeholder:"Count and enter actual physical cash"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Count and enter actual physical cash"})]}),Z!==0&&parseFloat(l.actualCashInHand)>0&&e.jsxs("div",{className:`p-3 rounded-lg border-2 ${Z>0?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsxs("p",{className:`font-semibold ${Z>0?"text-green-700":"text-red-700"}`,children:[Z>0?"Cash Excess":"Cash Shortage",": â‚¹",Math.abs(Z).toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:Math.abs(Z)>500?"âš ï¸ High discrepancy - requires approval from cluster head":"Discrepancy will be noted in records"})]}),e.jsx("div",{className:"col-span-2 mt-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-purple-50/80 to-purple-100/50 backdrop-blur-sm rounded-2xl p-5 border border-purple-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg",children:e.jsx(cs,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-xs font-semibold text-purple-700 uppercase tracking-wide",children:"Online Cash (Paytm) Reconciliation"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Expected Paytm Balance (â‚¹)"}),e.jsxs("div",{className:"bg-white/70 rounded-xl p-4 border border-purple-200/50",children:[e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["â‚¹",F.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:["Previous Paytm: â‚¹",(()=>{const s=new Date(n);s.setDate(s.getDate()-1);const t=s.toISOString().split("T")[0];return((o?a.salesData.find(i=>i.date===t&&i.storeId===o):a.salesData.find(i=>i.date===t))?.actualPaytmBalance||0).toFixed(2)})()," + Paytm Received: â‚¹",(parseFloat(l.paytmAmount)||0).toFixed(2)," + Online Payouts: â‚¹",(parseFloat(l.onlineSales)||0).toFixed(2)," - Used for Expenses: â‚¹",(parseFloat(l.usedOnlineMoney)||0).toFixed(2)," - Employee Payouts: â‚¹",R.toFixed(2)]}),e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-xs text-blue-600 cursor-pointer hover:underline flex items-center gap-1",children:"â–¸ View Paytm usage breakdown"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white p-2 rounded border border-purple-200",children:[e.jsx("p",{className:"font-semibold text-purple-700 mb-1",children:"Paytm Used for Expenses (from sales form):"}),e.jsxs("p",{className:"ml-2",children:["Amount Used from Paytm: â‚¹",(parseFloat(l.usedOnlineMoney)||0).toFixed(2)]}),e.jsx("p",{className:"font-semibold text-purple-700 mt-2 mb-1",children:"Employee Payouts (all from Paytm):"}),e.jsxs("p",{className:"ml-2",children:["Contract Workers: â‚¹",R.toFixed(2)]}),e.jsx("p",{className:"font-semibold text-purple-700 mt-2 mb-1",children:"Total Paytm Deductions:"}),e.jsxs("p",{className:"ml-2 font-medium",children:["â‚¹",((parseFloat(l.usedOnlineMoney)||0)+R).toFixed(2)]}),e.jsx("p",{className:"font-semibold text-purple-700 mt-2 mb-1",children:"Paytm Additions:"}),e.jsxs("p",{className:"ml-2",children:["Paytm Received: â‚¹",(parseFloat(l.paytmAmount)||0).toFixed(2)]}),e.jsxs("p",{className:"ml-2",children:["Online Payouts (Swiggy+Zomato): â‚¹",(parseFloat(l.onlineSales)||0).toFixed(2)]}),e.jsxs("p",{className:"ml-2 font-medium",children:["Total Additions: â‚¹",((parseFloat(l.paytmAmount)||0)+(parseFloat(l.onlineSales)||0)).toFixed(2)]})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:["Actual Paytm Balance (â‚¹) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",value:l.actualPaytmBalance,onChange:s=>U({...l,actualPaytmBalance:s.target.value}),className:"w-full px-4 py-3 border border-purple-300 rounded-xl bg-white/70 text-lg font-semibold focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all",required:!0,disabled:!re,placeholder:"Check and enter actual paytm balance"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ğŸ“± Check your Paytm wallet balance"})]}),ne!==0&&parseFloat(l.actualPaytmBalance)>0&&e.jsxs("div",{className:`p-3 rounded-lg border-2 ${ne>0?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsxs("p",{className:`font-semibold ${ne>0?"text-green-700":"text-red-700"}`,children:[ne>0?"Paytm Excess":"Paytm Shortage",": â‚¹",Math.abs(ne).toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:Math.abs(ne)>500?"âš ï¸ High discrepancy - requires approval from cluster head":"Discrepancy will be noted in records"})]})]})]})})]})]}),se&&f&&e.jsx("div",{className:"bg-white border border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"space-y-3",children:[(De||Ue)&&f.approvalRequested&&!f.approvedBy&&e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-300 text-yellow-800 px-4 py-3 rounded-lg",children:[e.jsx("p",{className:"font-semibold",children:"â³ Pending Approval"}),e.jsxs("p",{className:"mt-1",children:["This entry is waiting for cluster head approval due to high ",De&&Ue?"cash and Paytm discrepancy":De?"cash discrepancy":"Paytm discrepancy","."]})]}),f.approvedBy&&e.jsxs("div",{className:"bg-green-50 border-2 border-green-300 text-green-700 px-4 py-3 rounded-lg",children:[e.jsx("p",{className:"font-semibold",children:"âœ… Approved"}),e.jsxs("p",{className:"mt-1",children:["Approved by: ",f.approvedBy]}),f.approvalDate&&e.jsxs("p",{className:"text-sm",children:["Date: ",new Date(f.approvalDate).toLocaleString()]})]}),f.rejectedBy&&e.jsx("div",{className:"bg-red-50 border-2 border-red-300 text-red-700 px-4 py-3 rounded-lg",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"âŒ Rejected"}),e.jsxs("p",{className:"mt-1",children:["Rejected by: ",f.rejectedBy]}),f.rejectionDate&&e.jsxs("p",{className:"text-sm",children:["Date: ",new Date(f.rejectionDate).toLocaleString()]}),f.rejectionReason&&e.jsxs("p",{className:"mt-1 italic",children:["Reason: ",f.rejectionReason]}),e.jsx("p",{className:"mt-1 font-medium",children:"You must pay the discrepancy from your pocket."})]})})]})}),re&&e.jsxs("div",{className:"space-y-3",children:[_e&&e.jsxs("div",{className:"bg-red-100/80 border border-red-400/50 text-red-800 px-4 py-3 rounded-xl text-sm font-medium flex items-center gap-2 shadow-sm",children:[e.jsx(be,{className:"w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Cannot Save: Payment Mismatch"}),e.jsxs("div",{className:"text-xs mt-1",children:["Payment total (â‚¹",gs.toFixed(2),") must match offline sales (â‚¹",ke.toFixed(2),")"]})]})]}),e.jsxs("button",{type:"submit",disabled:_e||C,className:"w-full px-6 py-3.5 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 font-semibold text-sm",children:[C&&e.jsx(bs,{className:"w-5 h-5 animate-spin"}),C?"Saving...":se?"Update Sales Data":"Save Sales Data"]}),se&&$&&(De||Ue)&&!f?.approvedBy&&!f?.approvalRequested&&e.jsxs("button",{type:"button",onClick:ut,className:"w-full px-6 py-3.5 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2 font-semibold text-sm",children:[e.jsx(be,{className:"w-5 h-5"}),"Request Approval from Cluster Head"]}),se&&f?.approvalRequested&&!f?.approvedBy&&!f?.rejectedBy&&e.jsx("div",{className:"w-full px-6 py-3 bg-orange-100/80 border border-orange-300/50 text-orange-800 rounded-xl text-center text-sm font-medium shadow-sm",children:"â³ Approval request sent - Waiting for cluster head response"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50/80 to-green-100/50 backdrop-blur-sm rounded-2xl p-5 border border-green-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-green-500/10 rounded-lg",children:e.jsx(Ne,{className:"w-5 h-5 text-green-600"})}),e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Total Sales"})]}),e.jsxs("p",{className:"text-4xl font-bold text-gray-900",children:["â‚¹",(ke+rs).toLocaleString()]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-green-200/50 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Offline Sales:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["â‚¹",ke.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Online Sales:"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["â‚¹",rs.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50/80 to-blue-100/50 backdrop-blur-sm rounded-2xl p-5 border border-blue-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-500/10 rounded-lg",children:e.jsx(je,{className:"w-5 h-5 text-blue-600"})}),e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Payment Breakdown"})]}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Cash Received:"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["â‚¹",hs.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Paytm Received:"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["â‚¹",ps.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-blue-200/50",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Online Sales:"}),e.jsxs("span",{className:"text-xl font-bold text-gray-900",children:["â‚¹",rs.toLocaleString()]})]})]})]}),!$e&&e.jsxs("div",{className:"bg-gradient-to-br from-violet-50/80 to-purple-100/50 backdrop-blur-sm rounded-2xl p-5 border border-purple-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-purple-500/10 rounded-lg",children:e.jsx(je,{className:"w-5 h-5 text-purple-600"})}),e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Cash Status"})]}),A>0&&e.jsxs("button",{onClick:()=>G(!0),className:"flex items-center gap-1 px-2.5 py-1 bg-purple-600/10 hover:bg-purple-600/20 rounded-lg text-xs font-semibold transition-colors text-purple-700",title:"Convert Offline Cash to Online Cash (Paytm)",children:[e.jsx(js,{className:"w-3 h-3"}),"Convert to Online"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Expected Cash"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["â‚¹",A.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Previous Cash: â‚¹",(parseFloat(l.previousCashInHand)||0).toFixed(2)," + Amount Used from Paytm: â‚¹",(parseFloat(l.usedOnlineMoney)||0).toFixed(2)," + Cash Received: â‚¹",hs.toFixed(2)," - Expenses: â‚¹",qe.toFixed(2)," - Contract Payouts: â‚¹",R.toFixed(2)]})]}),l.actualCashInHand&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pt-3 border-t border-purple-200/50",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Actual Cash"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["â‚¹",(parseFloat(l.actualCashInHand)||0).toFixed(2)]})]}),Math.abs(Z)>0&&e.jsxs("div",{className:"pt-3 border-t border-purple-200/50",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Difference"}),e.jsxs("p",{className:`text-2xl font-bold ${Z>0?"text-green-600":"text-red-600"}`,children:[Z>0?"+":"","â‚¹",Z.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50/80 to-violet-100/50 backdrop-blur-sm rounded-2xl p-5 border border-purple-200/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-purple-500/10 rounded-lg",children:e.jsx(cs,{className:"w-5 h-5 text-purple-600"})}),e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Online Cash in Hand (Paytm)"})]}),e.jsxs("p",{className:"text-4xl font-bold text-gray-900 mb-4",children:["â‚¹",F.toLocaleString()]}),e.jsxs("div",{className:"space-y-2 text-sm bg-gray-800/10 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between text-green-700",children:[e.jsx("span",{children:"+ Paytm In:"}),e.jsxs("span",{children:["â‚¹",(()=>{const t=a.onlineCashRecalibrations.filter(x=>x.storeId===o&&x.date<=n).sort((x,u)=>u.date.localeCompare(x.date))[0]?.date||"0000-00-00";return((o?a.salesData.filter(x=>x.storeId===o&&x.date>t&&x.date<n):a.salesData.filter(x=>x.date>t&&x.date<n)).reduce((x,u)=>x+(u.paytmAmount??0),0)+ps).toLocaleString()})()]})]}),e.jsxs("div",{className:"flex justify-between text-emerald-700",children:[e.jsx("span",{children:"+ Online Payouts:"}),e.jsxs("span",{children:["â‚¹",(()=>{const t=a.onlineCashRecalibrations.filter(x=>x.storeId===o&&x.date<=n).sort((x,u)=>u.date.localeCompare(x.date))[0]?.date||"0000-00-00";return((o?a.salesData.filter(x=>x.storeId===o&&x.date>t&&x.date<n):a.salesData.filter(x=>x.date>t&&x.date<n)).reduce((x,u)=>x+(u.onlineSales??0),0)+rs).toLocaleString()})()]})]}),e.jsxs("div",{className:"flex justify-between text-red-700",children:[e.jsx("span",{children:"- Used for Expenses:"}),e.jsxs("span",{children:["â‚¹",(()=>{const t=a.onlineCashRecalibrations.filter(r=>r.storeId===o&&r.date<=n).sort((r,i)=>i.date.localeCompare(r.date))[0]?.date||"0000-00-00";return ze.filter(r=>r.date>t).reduce((r,i)=>r+i.usedOnlineMoney,0).toLocaleString()})()]})]}),e.jsxs("div",{className:"flex justify-between text-orange-700",children:[e.jsx("span",{children:"- Employee Payouts:"}),e.jsxs("span",{children:["â‚¹",(()=>{const t=a.onlineCashRecalibrations.filter(r=>r.storeId===o&&r.date<=n).sort((r,i)=>i.date.localeCompare(r.date))[0]?.date||"0000-00-00";return ze.filter(r=>r.date>t).reduce((r,i)=>r+(i.employeePayouts||0),0).toLocaleString()})()]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700 pt-2 border-t border-gray-700/20",children:[e.jsx("span",{children:"Used Today:"}),e.jsxs("span",{children:["â‚¹",(parseFloat(l.usedOnlineMoney)||0).toLocaleString()]})]}),R>0&&e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Employee Payouts Today:"}),e.jsxs("span",{children:["â‚¹",R.toLocaleString()]})]}),As>0&&e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Fixed Costs Today (Online):"}),e.jsxs("span",{children:["â‚¹",As.toLocaleString()]})]}),Is>0&&e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Overhead Costs Today (Online):"}),e.jsxs("span",{children:["â‚¹",Is.toLocaleString()]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:()=>v(!0),className:"w-full px-4 py-2 bg-white/20 hover:bg-white/30 text-gray-800 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm font-medium",children:[e.jsx(Gs,{className:"w-4 h-4"}),"Daily Breakdown"]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50/80 to-orange-100/50 backdrop-blur-sm rounded-2xl p-5 border border-yellow-300/50 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-1.5 bg-yellow-500/10 rounded-lg",children:e.jsx(je,{className:"w-5 h-5 text-yellow-700"})}),e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Total Cash (Offline + Paytm)"})]}),e.jsxs("p",{className:"text-4xl font-bold text-gray-900 mb-4",children:["â‚¹",(A+F).toLocaleString()]}),e.jsxs("div",{className:"space-y-2 text-sm bg-white/70 rounded-xl p-3 border border-yellow-200/50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Expected Cash (Offline):"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:["â‚¹",A.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-yellow-200/50",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Online Cash (Paytm):"}),e.jsxs("span",{className:"text-xl font-semibold text-gray-900",children:["â‚¹",F.toLocaleString()]})]})]})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-white/80 to-gray-50/50 backdrop-blur-sm rounded-2xl shadow-sm border border-gray-200/50 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg",children:e.jsx(Ne,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Loan Management"}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:"Track loans taken and repayments made"})]})]}),e.jsxs("button",{onClick:()=>Le(!0),className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all flex items-center gap-2 shadow-md",children:[e.jsx(Hs,{className:"w-4 h-4"}),"Apply Loan"]})]}),(()=>{const s=w.filter(x=>x.status==="active"),t=s.reduce((x,u)=>x+u.loanAmount,0),r=s.reduce((x,u)=>x+u.repaidAmount,0),i=s.reduce((x,u)=>x+(u.loanAmount-u.repaidAmount),0);return s.length>0&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Active Loans"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700",children:["â‚¹",t.toLocaleString()]})]}),e.jsxs("div",{className:"bg-green-50 border-2 border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Repaid"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["â‚¹",r.toLocaleString()]})]}),e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Remaining to Pay"}),e.jsxs("p",{className:"text-2xl font-bold text-red-700",children:["â‚¹",i.toLocaleString()]})]})]})})(),de?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(bs,{className:"w-6 h-6 animate-spin text-purple-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading loans..."})]}):w.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(Ne,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No loans recorded yet"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:'Click "Apply Loan" to add a loan'})]}):e.jsx("div",{className:"space-y-3",children:w.map(s=>{const t=s.loanAmount-s.repaidAmount,r=s.repaidAmount/s.loanAmount*100;return e.jsxs("div",{className:`border-2 rounded-lg p-4 ${s.status==="active"?"border-blue-200 bg-blue-50":"border-green-200 bg-green-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${s.status==="active"?"bg-blue-200 text-blue-800":"bg-green-200 text-green-800"}`,children:s.status==="active"?"Active":"Repaid"}),e.jsx("span",{className:"text-sm text-gray-600",children:new Date(s.loanDate).toLocaleDateString("en-IN")})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:s.notes||"No notes"})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Loan Amount"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["â‚¹",s.loanAmount.toLocaleString()]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsxs("span",{children:["Repaid: â‚¹",s.repaidAmount.toLocaleString()]}),e.jsxs("span",{children:["Remaining: â‚¹",t.toLocaleString()]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${s.status==="repaid"?"bg-green-500":"bg-blue-500"}`,style:{width:`${r}%`}})}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1 text-center",children:[r.toFixed(0),"% repaid"]})]}),s.status==="active"&&e.jsxs("button",{onClick:()=>{He(s),Te(!0)},className:"w-full px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all flex items-center justify-center gap-2 text-sm font-medium",children:[e.jsx(Bs,{className:"w-4 h-4"}),"Repay Loan"]}),s.status==="repaid"&&s.repaymentDate&&e.jsxs("div",{className:"text-center text-xs text-green-700 mt-2",children:["âœ… Fully repaid on ",new Date(s.repaymentDate).toLocaleDateString("en-IN")]})]},s.id)})})]})}),ve&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:()=>v(!1),children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Paytm Daily Breakdown"}),e.jsx("p",{className:"text-purple-100 mt-1",children:"Complete transaction history"})]}),e.jsx("button",{onClick:()=>v(!1),className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(ds,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Received"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["â‚¹",ze.reduce((s,t)=>s+t.paytmReceived+t.onlinePayouts+(t.loansTaken||0),0).toLocaleString()]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Total Used"}),e.jsxs("p",{className:"text-2xl font-bold text-red-700",children:["â‚¹",ze.reduce((s,t)=>s+t.usedOnlineMoney+t.commission+(t.employeePayouts||0)+(t.loanRepayments||0),0).toLocaleString()]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Current Balance"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700",children:["â‚¹",F.toLocaleString()]})]})]}),e.jsx("div",{className:"space-y-2",children:ze.map((s,t)=>{const r=s.runningBalance,i=s.date===n;return e.jsxs("div",{className:`border rounded-lg p-4 ${i?"border-purple-400 bg-purple-50":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{children:e.jsxs("p",{className:"font-semibold text-gray-900",children:[Je(s.date),i&&e.jsx("span",{className:"ml-2 text-xs bg-purple-500 text-white px-2 py-1 rounded-full",children:"Today"})]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Running Balance"}),e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:["â‚¹",r.toLocaleString()]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[s.paytmReceived>0&&e.jsxs("div",{className:"flex justify-between items-center bg-green-50 px-3 py-2 rounded",children:[e.jsx("span",{className:"text-green-700",children:"+ Paytm In:"}),e.jsxs("span",{className:"font-semibold text-green-800",children:["â‚¹",s.paytmReceived.toLocaleString()]})]}),s.onlinePayouts>0&&e.jsxs("div",{className:"flex justify-between items-center bg-emerald-50 px-3 py-2 rounded",children:[e.jsx("span",{className:"text-emerald-700",children:"+ Online Payouts:"}),e.jsxs("span",{className:"font-semibold text-emerald-800",children:["â‚¹",s.onlinePayouts.toLocaleString()]})]}),s.usedOnlineMoney>0&&e.jsxs("div",{className:"flex justify-between items-center bg-red-50 px-3 py-2 rounded",children:[e.jsx("span",{className:"text-red-700",children:"- Used for Expenses:"}),e.jsxs("span",{className:"font-semibold text-red-800",children:["â‚¹",s.usedOnlineMoney.toLocaleString()]})]}),s.commission>0&&e.jsxs("div",{className:"flex justify-between items-center bg-rose-50 px-3 py-2 rounded",children:[e.jsx("span",{className:"text-rose-700",children:"- Commission:"}),e.jsxs("span",{className:"font-semibold text-rose-800",children:["â‚¹",s.commission.toLocaleString()]})]}),s.employeePayouts>0&&e.jsxs("div",{className:"flex justify-between items-center bg-orange-50 px-3 py-2 rounded",children:[e.jsx("span",{className:"text-orange-700",children:"- Employee Payouts:"}),e.jsxs("span",{className:"font-semibold text-orange-800",children:["â‚¹",s.employeePayouts.toLocaleString()]})]}),s.loansTaken>0&&e.jsxs("div",{className:"flex justify-between items-center bg-blue-50 px-3 py-2 rounded",children:[e.jsx("span",{className:"text-blue-700",children:"+ Loan Received:"}),e.jsxs("span",{className:"font-semibold text-blue-800",children:["â‚¹",s.loansTaken.toLocaleString()]})]}),s.loanRepayments>0&&e.jsxs("div",{className:"flex justify-between items-center bg-amber-50 px-3 py-2 rounded",children:[e.jsx("span",{className:"text-amber-700",children:"- Loan Repayment:"}),e.jsxs("span",{className:"font-semibold text-amber-800",children:["â‚¹",s.loanRepayments.toLocaleString()]})]})]})]},s.date)})})]})]})}),Se&&e.jsxs("div",{className:"mt-6 space-y-4",children:[a.salesData.filter(s=>s.approvalStatus==="pending"&&s.createdBy!==a.user?.employeeId).length>0&&e.jsxs("div",{className:"bg-[#E8F5E9] border-2 border-[#A5D6A7] rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($s,{className:"w-6 h-6 text-green-600"}),e.jsx("h2",{className:"text-gray-900",children:"Sales Pending Approval"})]}),e.jsx("div",{className:"space-y-3",children:a.salesData.filter(s=>s.approvalStatus==="pending"&&s.createdBy!==a.user?.employeeId).map(s=>e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-300",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-gray-900 font-medium",children:Je(s.date)}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Submitted by: ",s.createdBy]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"ml-1 font-medium",children:["â‚¹",(s.offlineSales+s.onlineSales).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Cash in Hand:"}),e.jsxs("span",{className:"ml-1 font-medium",children:["â‚¹",s.actualCashInHand.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{try{await a.approveSalesData(s.id),alert("Sales approved successfully!")}catch{alert("Failed to approve sales")}},className:"flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-all",children:"âœ“ Approve"}),e.jsx("button",{onClick:async()=>{try{await a.rejectSalesData(s.id),alert("Sales rejected successfully!")}catch{alert("Failed to reject sales")}},className:"flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-all",children:"âœ— Reject"})]})]},s.id))})]}),a.salesData.filter(s=>s.approvalStatus==="pending"&&s.createdBy!==a.user?.employeeId).length===0&&e.jsxs("div",{className:"bg-[#E8F5E9] border-2 border-[#A5D6A7] rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($s,{className:"w-6 h-6 text-green-600"}),e.jsx("h2",{className:"text-gray-900",children:"Sales Pending Approval"})]}),e.jsx("p",{className:"text-gray-600",children:"No pending sales at the moment."})]})]})]}),ss&&e.jsx(Tt,{context:a,selectedStoreId:o,selectedDate:n,onClose:()=>Le(!1),onSaveSuccess:async()=>{await ms()}}),ts&&Be&&e.jsx(Bt,{context:a,loan:Be,selectedDate:n,onClose:()=>{Te(!1),He(null)},onSaveSuccess:async()=>{await ms()}}),me&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(js,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"Convert Cash to Online"})]}),e.jsx("button",{onClick:()=>{G(!1),ye("")},className:"p-1 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(ds,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg p-4 border border-purple-200",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-3",children:"Convert offline cash in hand to online cash (Paytm). This is useful when you transfer physical cash to your Paytm account."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Current Expected Cash"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["â‚¹",A.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Current Online Cash"}),e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:["â‚¹",F.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Amount to Convert (â‚¹)"}),e.jsx("input",{type:"number",value:J,onChange:s=>ye(s.target.value),placeholder:"Enter amount",step:"0.01",min:"0",max:A,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-lg",disabled:we}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Max: â‚¹",A.toFixed(2)]})]}),parseFloat(J)>0&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-4 border border-green-200",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"After Conversion:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Expected Cash:"}),e.jsxs("span",{className:"font-bold text-gray-900",children:["â‚¹",A.toFixed(2)," â†’ â‚¹",(A-parseFloat(J)).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Online Cash:"}),e.jsxs("span",{className:"font-bold text-purple-600",children:["â‚¹",F.toFixed(2)," â†’ â‚¹",(F+parseFloat(J)).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{G(!1),ye("")},className:"flex-1 px-4 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold transition-colors",disabled:we,children:"Cancel"}),e.jsx("button",{onClick:ht,disabled:!J||parseFloat(J)<=0||we,className:"flex-1 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:we?e.jsxs(e.Fragment,{children:[e.jsx(bs,{className:"w-4 h-4 animate-spin"}),"Converting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(js,{className:"w-4 h-4"}),"Convert"]})})]})]})]})}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 p-6 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"Confirm Sales Data"})]}),e.jsx("button",{onClick:xs,className:"p-1 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(ds,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 rounded-lg p-4 border border-yellow-200",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-3 font-semibold",children:"You are about to save sales data with the following values:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Offline Sales:"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",parseFloat(l.offlineSales)||0]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Expected Cash:"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",A.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Actual Cash:"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",parseFloat(l.actualCashInHand)||0]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-gray-600",children:"Cash Discrepancy:"}),e.jsxs("span",{className:`font-bold ${Z===0?"text-green-600":Z>0?"text-blue-600":"text-red-600"}`,children:["â‚¹",Z.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2 mt-2",children:[e.jsx("span",{className:"text-gray-600",children:"Expected Paytm:"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",F.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Actual Paytm:"}),e.jsxs("span",{className:"font-semibold",children:["â‚¹",parseFloat(l.actualPaytmBalance)||0]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-gray-600",children:"Paytm Discrepancy:"}),e.jsxs("span",{className:`font-bold ${ne===0?"text-green-600":ne>0?"text-blue-600":"text-red-600"}`,children:["â‚¹",ne.toFixed(2)]})]})]})]}),(F<0||A+F<0)&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"âš ï¸ Warning: Negative Balance Detected"}),F<0&&e.jsxs("p",{className:"mb-1",children:["â€¢ Online Cash (Paytm) is negative: â‚¹",F.toFixed(2)]}),A+F<0&&e.jsxs("p",{children:["â€¢ Total Combined Cash is negative: â‚¹",(A+F).toFixed(2)]})]})]})}),e.jsxs("div",{className:"flex items-start gap-3 bg-gray-50 rounded-lg p-4",children:[e.jsx("input",{type:"checkbox",id:"confirm-responsibility",checked:k,onChange:s=>ae(s.target.checked),className:"mt-1 w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),e.jsx("label",{htmlFor:"confirm-responsibility",className:"text-sm text-gray-700 cursor-pointer",children:"I confirm that I have verified this sales data and take responsibility for its accuracy. I understand that this data will be used for financial reporting and analysis."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:xs,className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-lg font-semibold hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:mt,disabled:!k,className:`flex-1 px-4 py-3 rounded-lg font-semibold transition-colors ${k?"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Save Sales Data"})]})]})]})})]})})}export{qt as SalesManagement};
