import{r as p,j as e,Z as k,h as C,b as y,i as H,T as P,N as $}from"./index-BWZpdZV9.js";import{S as A}from"./send-0T6r7yBU.js";function O({context:t,stores:q}){const[c,j]=p.useState("my-requests"),[I,b]=p.useState(!1),[i,x]=p.useState({requestId:null,quantities:{},notes:""}),d=t.user?.designation==="store_incharge",g=t.user?.designation==="production_incharge",u=q.find(s=>s.id===t.user?.storeId),m=t.productionHouses.find(s=>s.productionHeadId===t.user?.employeeId),[l,o]=p.useState({chicken:0,chickenCheese:0,veg:0,cheeseCorn:0,paneer:0,vegKurkure:0,chickenKurkure:0}),S=async s=>{if(s.preventDefault(),!u){alert("You must be assigned to a store to create requests");return}if(!u.productionHouseId){alert("Your store is not mapped to any production house. Contact cluster head.");return}const a=t.productionHouses.find(r=>r.id===u.productionHouseId);if(!a){alert("Production house not found");return}if(!Object.values(l).some(r=>r>0)){alert("Please enter at least one quantity greater than 0");return}try{const r={storeId:u.id,storeName:u.name,productionHouseId:a.id,productionHouseName:a.name,requestedBy:t.user?.employeeId||"",requestedByName:t.user?.name||"",requestDate:new Date().toISOString().split("T")[0],requestedQuantities:l};console.log("ðŸ”µ FRONTEND: About to create stock request with data:",r),console.log("ðŸ”µ User employeeId:",t.user?.employeeId),console.log("ðŸ”µ User name:",t.user?.name),console.log("ðŸ”µ Has access token:",!!t.user?.accessToken),await t.createStockRequest(r),console.log("âœ… FRONTEND: Stock request created successfully!"),alert("Stock request created successfully!"),b(!1),o({chicken:0,chickenCheese:0,veg:0,cheeseCorn:0,paneer:0,vegKurkure:0,chickenKurkure:0})}catch(r){console.error("âŒ FRONTEND: Error creating stock request:",r),console.error("âŒ Error details:",JSON.stringify(r,null,2)),alert("Failed to create stock request. Please try again.")}},R=async s=>{m&&x({requestId:s.id,quantities:{...s.requestedQuantities},notes:""})},F=async s=>{if(s.preventDefault(),!!i.requestId)try{await t.fulfillStockRequest(i.requestId,i.quantities,t.user?.employeeId||"",t.user?.name||"",i.notes||void 0),alert("Stock request fulfilled successfully!"),x({requestId:null,quantities:{},notes:""})}catch(a){console.error("Error fulfilling request:",a),alert("Failed to fulfill request. Please try again.")}},f=d?t.stockRequests.filter(s=>s.storeId===t.user?.storeId):[],h=g&&m?t.stockRequests.filter(s=>s.productionHouseId===m.id&&s.status==="pending"):[],N=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"fulfilled":return"bg-green-100 text-green-800";case"partially_fulfilled":return"bg-blue-100 text-blue-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},v=s=>{switch(s){case"pending":return e.jsx($,{className:"w-4 h-4"});case"fulfilled":return e.jsx(y,{className:"w-4 h-4"});case"partially_fulfilled":return e.jsx(P,{className:"w-4 h-4"});case"cancelled":return e.jsx(H,{className:"w-4 h-4"});default:return e.jsx(C,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl text-gray-900 flex items-center gap-3",children:[e.jsx(k,{className:"w-8 h-8 text-blue-600"}),"Stock Request Management"]}),e.jsxs("p",{className:"text-gray-600 mt-2",children:[d&&"Request stock from your production house",g&&"Fulfill stock requests from stores"]})]}),d&&e.jsxs("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),"New Request"]})]}),d&&u&&!u.productionHouseId&&e.jsx("div",{className:"mb-6 bg-red-50 border-2 border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"w-5 h-5 text-red-600"}),e.jsx("p",{className:"text-red-900",children:"Your store is not mapped to any production house. Please contact your cluster head to assign a production house."})]})}),(d||g)&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-1 mb-6 flex gap-2",children:[d&&e.jsxs("button",{onClick:()=>j("my-requests"),className:`flex-1 px-6 py-3 rounded-lg transition-all ${c==="my-requests"?"bg-blue-600 text-white shadow-lg":"text-gray-700 hover:bg-gray-100"}`,children:["My Requests (",f.length,")"]}),g&&e.jsxs("button",{onClick:()=>j("pending-fulfillment"),className:`flex-1 px-6 py-3 rounded-lg transition-all flex items-center justify-center gap-2 ${c==="pending-fulfillment"?"bg-blue-600 text-white shadow-lg":"text-gray-700 hover:bg-gray-100"}`,children:["Pending Fulfillment",h.length>0&&e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${c==="pending-fulfillment"?"bg-white text-blue-600":"bg-blue-600 text-white"}`,children:h.length})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl text-gray-900 mb-4",children:"Create Stock Request"}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Chicken Momos"}),e.jsx("input",{type:"number",min:"0",value:l.chicken,onChange:s=>o({...l,chicken:parseInt(s.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Chicken Cheese Momos"}),e.jsx("input",{type:"number",min:"0",value:l.chickenCheese,onChange:s=>o({...l,chickenCheese:parseInt(s.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Veg Momos"}),e.jsx("input",{type:"number",min:"0",value:l.veg,onChange:s=>o({...l,veg:parseInt(s.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Cheese Corn Momos"}),e.jsx("input",{type:"number",min:"0",value:l.cheeseCorn,onChange:s=>o({...l,cheeseCorn:parseInt(s.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Paneer Momos"}),e.jsx("input",{type:"number",min:"0",value:l.paneer,onChange:s=>o({...l,paneer:parseInt(s.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Veg Kurkure Momos"}),e.jsx("input",{type:"number",min:"0",value:l.vegKurkure,onChange:s=>o({...l,vegKurkure:parseInt(s.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Chicken Kurkure Momos"}),e.jsx("input",{type:"number",min:"0",value:l.chickenKurkure,onChange:s=>o({...l,chickenKurkure:parseInt(s.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Create Request"})]})]})]})}),i.requestId&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl text-gray-900 mb-4",children:"Fulfill Stock Request"}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-blue-900",children:"Adjust quantities based on available inventory. You can fulfill partially if stock is limited."})}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(i.quantities).map(([s,a])=>{const n=m?.inventory[s]||0;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-700 mb-1",children:[s.replace(/([A-Z])/g," $1").replace(/^./,r=>r.toUpperCase()),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(Available: ",n,")"]})]}),e.jsx("input",{type:"number",min:"0",max:n,value:a,onChange:r=>x({...i,quantities:{...i.quantities,[s]:parseInt(r.target.value)||0}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]},s)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{value:i.notes,onChange:s=>x({...i,notes:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Any notes about this fulfillment..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>x({requestId:null,quantities:{},notes:""}),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Fulfill Request"})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[c==="my-requests"&&f.length===0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-12 text-center",children:[e.jsx(k,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl text-gray-900 mb-2",children:"No Stock Requests Yet"}),e.jsx("p",{className:"text-gray-600",children:"Create your first stock request to get momos from the production house"})]}),c==="pending-fulfillment"&&h.length===0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-12 text-center",children:[e.jsx(y,{className:"w-16 h-16 mx-auto text-green-500 mb-4"}),e.jsx("h3",{className:"text-xl text-gray-900 mb-2",children:"All Caught Up!"}),e.jsx("p",{className:"text-gray-600",children:"No pending stock requests to fulfill"})]}),c==="my-requests"&&f.map(s=>e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h3",{className:"text-lg text-gray-900",children:["Request to ",s.productionHouseName]}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs flex items-center gap-1 ${N(s.status)}`,children:[v(s.status),s.status.replace("_"," ").toUpperCase()]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Requested on ",new Date(s.requestDate).toLocaleDateString()]})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4",children:Object.entries(s.requestedQuantities).map(([a,n])=>n>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:a.replace(/([A-Z])/g," $1").replace(/^./,r=>r.toUpperCase())}),e.jsx("div",{className:"text-lg text-gray-900",children:s.fulfilledQuantities?`${s.fulfilledQuantities[a]} / ${n}`:n})]},a))}),s.notes&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 mb-4",children:[e.jsx("div",{className:"text-xs text-blue-900 mb-1",children:"Notes from Production Head:"}),e.jsx("div",{className:"text-sm text-blue-900",children:s.notes})]}),s.fulfilledBy&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Fulfilled by ",s.fulfilledByName," on ",new Date(s.fulfillmentDate).toLocaleDateString()]})]},s.id)),c==="pending-fulfillment"&&h.map(s=>e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 border-2 border-yellow-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h3",{className:"text-lg text-gray-900",children:["Request from ",s.storeName]}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs flex items-center gap-1 ${N(s.status)}`,children:[v(s.status),"PENDING"]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Requested by ",s.requestedByName," on ",new Date(s.requestDate).toLocaleDateString()]})]}),e.jsxs("button",{onClick:()=>R(s),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),"Fulfill"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(s.requestedQuantities).map(([a,n])=>{const r=m?.inventory[a]||0,w=r>=n;return n>0&&e.jsxs("div",{className:`rounded-lg p-3 ${w?"bg-green-50":"bg-red-50"}`,children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:a.replace(/([A-Z])/g," $1").replace(/^./,D=>D.toUpperCase())}),e.jsx("div",{className:"text-lg text-gray-900",children:n}),e.jsxs("div",{className:`text-xs ${w?"text-green-600":"text-red-600"}`,children:["Available: ",r]})]},a)})})]},s.id))]})]})}export{O as StockRequestManagement};
