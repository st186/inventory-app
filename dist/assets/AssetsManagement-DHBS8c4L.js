import{c as je,r as l,aI as fe,aK as Ne,aR as ve,j as e,P as we,ac as J,aH as W,X as Q,aS as Se,aT as ke,U as G,_ as se,aU as Ce,E as Ie,aV as Me,aW as Pe,aX as Ae,aY as He,aZ as Ee,a_ as te,w as Le,b as K,a4 as N,a$ as Te,f as $e,b0 as Fe,b1 as Re,b2 as ee,O as ae,aG as De,aj as Ue,T as ne,i as Oe,b3 as _e,b4 as Be,b5 as ze,Z as re}from"./index-RP5sFzS9.js";import{ProductionHouseManagement as Je}from"./ProductionHouseManagement-DkQUIzx9.js";import{S as oe}from"./settings-BuyoiAGJ.js";import{P as le}from"./phone-CbaEWjyE.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],Xe=je("building",qe);function Ye({onStoreCreated:r,userRole:c}){const[y,m]=l.useState([]),[g,h]=l.useState([]),[d,u]=l.useState([]),[j,R]=l.useState(!0),[C,I]=l.useState(!1),[D,n]=l.useState(null),[i,f]=l.useState(null),[U,M]=l.useState(null),[w,P]=l.useState(""),[A,H]=l.useState(""),[E,L]=l.useState(!1),[T,S]=l.useState(""),[q,O]=l.useState(""),[X,Y]=l.useState(!1),[$,b]=l.useState(""),[_,a]=l.useState(!1),[o,x]=l.useState(""),[F,B]=l.useState(!1);l.useEffect(()=>{k(),Z(),p()},[]);const k=async()=>{try{const s=await fe();m(s)}catch(s){if(s instanceof Error&&(s.message==="Not authenticated"||s.message==="Unauthorized"))return;console.error("Error loading stores:",s)}finally{R(!1)}},Z=async()=>{try{const t=(await Ne()).filter(z=>z.role==="manager");h(t)}catch(s){console.error("Error loading managers:",s)}},p=async()=>{try{const s=await ve();u(s)}catch(s){console.error("Error loading production houses:",s)}},v=async s=>{if(s.preventDefault(),!w.trim()){alert("Please enter a store name");return}L(!0);try{await Me(w,A),P(""),H(""),I(!1),await k(),r&&r()}catch(t){console.error("Error creating store:",t),alert(t.message||"Failed to create store")}finally{L(!1)}},V=s=>{n(s.id),S(s.name),O(s.location)},ie=async s=>{if(!T.trim()){alert("Please enter a store name");return}Y(!0);try{await Pe(s,T,q),n(null),await k()}catch(t){console.error("Error updating store:",t),alert(t.message||"Failed to update store")}finally{Y(!1)}},de=()=>{n(null),S(""),O("")},ce=s=>{f(s.id),b(s.managerId||"")},me=async s=>{if(!$){alert("Please select a manager");return}a(!0);try{await Ae(s,$),f(null),b(""),await k(),await Z(),alert("Manager assigned successfully!")}catch(t){console.error("Error assigning manager:",t),alert(t.message||"Failed to assign manager")}finally{a(!1)}},ue=()=>{f(null),b("")},xe=async s=>{if(confirm(`Migrate all existing data (inventory, sales, payroll, employees) to ${s.name}? This will assign all data without a store to this store.`))try{const t=await Ee(s.id);alert(`âœ… Migration successful!

Inventory: ${t.migratedCount.inventory}
Overheads: ${t.migratedCount.overheads}
Sales: ${t.migratedCount.sales}
Employees: ${t.migratedCount.employees}
Timesheets: ${t.migratedCount.timesheets}
Leaves: ${t.migratedCount.leaves}
Payouts: ${t.migratedCount.payouts}`)}catch(t){console.error("Error migrating data:",t),alert(t.message||"Failed to migrate data")}},ge=s=>{M(s.id),x(s.productionHouseId||"")},he=async s=>{if(!o){alert("Please select a production house");return}B(!0);try{await He(s,o),M(null),x(""),await k(),await p(),r&&r(),alert("Production house assigned successfully!")}catch(t){console.error("Error assigning production house:",t),alert(t.message||"Failed to assign production house")}finally{B(!1)}},pe=()=>{M(null),x("")},be=s=>{if(!s)return null;const t=g.find(z=>z.employeeId===s);return t?`${t.name} (${t.employeeId})`:"Unknown Manager"},ye=s=>{if(!s)return null;const t=d.find(z=>z.id===s);return t?`${t.name} (${t.id})`:"Unknown Production House"};return j?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-gray-500",children:"Loading stores..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-gray-900 mb-1",children:"ðŸª Store Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your stores and assign managers"})]}),e.jsxs("button",{onClick:()=>I(!C),className:"flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors",children:[e.jsx(we,{className:"w-5 h-5"}),"Create Store"]})]}),C&&e.jsxs("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg text-gray-900 mb-4",children:"Create New Store"}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-700 mb-1",children:["Store Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:w,onChange:s=>P(s.target.value),placeholder:"e.g., Downtown Branch, Main Street Store",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Location (Optional)"}),e.jsx("input",{type:"text",value:A,onChange:s=>H(s.target.value),placeholder:"e.g., 123 Main St, City",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:E,className:"flex-1 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors disabled:opacity-50",children:E?"Creating...":"Create Store"}),e.jsx("button",{type:"button",onClick:()=>{I(!1),P(""),H("")},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.length===0?e.jsxs("div",{className:"col-span-full bg-white rounded-lg border border-gray-200 p-8 text-center",children:[e.jsx(J,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No stores yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Create your first store to get started"})]}):y.map(s=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow",children:D===s.id?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Store Name"}),e.jsx("input",{type:"text",value:T,onChange:t=>S(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Location"}),e.jsx("input",{type:"text",value:q,onChange:t=>O(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>ie(s.id),disabled:X,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm disabled:opacity-50",children:[e.jsx(W,{className:"w-4 h-4"}),"Save"]}),e.jsxs("button",{onClick:de,disabled:X,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm disabled:opacity-50",children:[e.jsx(Q,{className:"w-4 h-4"}),"Cancel"]})]})]}):i===s.id?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-gray-900",children:["Assign Manager to ",s.name]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Select Manager"}),e.jsxs("select",{value:$,onChange:t=>b(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"Choose a manager..."}),g.filter(t=>!t.storeId||t.storeId===s.id).map(t=>e.jsxs("option",{value:t.employeeId,children:[t.name," (",t.employeeId,")"]},t.employeeId))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only unassigned managers or current manager shown"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>me(s.id),disabled:_||!$,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 text-sm disabled:opacity-50",children:[e.jsx(W,{className:"w-4 h-4"}),_?"Assigning...":"Assign"]}),e.jsxs("button",{onClick:ue,disabled:_,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm disabled:opacity-50",children:[e.jsx(Q,{className:"w-4 h-4"}),"Cancel"]})]})]}):U===s.id?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-gray-900",children:["Assign Production House to ",s.name]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Select Production House"}),e.jsxs("select",{value:o,onChange:t=>x(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"Choose a production house..."}),d.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select which production house will serve this store"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>he(s.id),disabled:F||!o,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 text-sm disabled:opacity-50",children:[e.jsx(W,{className:"w-4 h-4"}),F?"Assigning...":"Assign"]}),e.jsxs("button",{onClick:pe,disabled:F,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm disabled:opacity-50",children:[e.jsx(Q,{className:"w-4 h-4"}),"Cancel"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-gray-900",children:s.name})]}),e.jsx("button",{onClick:()=>V(s),className:"p-1 text-gray-400 hover:text-gray-600 rounded",children:e.jsx(Se,{className:"w-4 h-4"})})]}),s.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{children:s.location})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-200 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(G,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:s.managerId?e.jsx("span",{className:"text-green-600",children:be(s.managerId)}):e.jsx("span",{className:"text-orange-600",children:"No Manager Assigned"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:s.productionHouseId?e.jsx("span",{className:"text-green-600",children:ye(s.productionHouseId)}):e.jsx("span",{className:"text-orange-600",children:"No Production House Mapped"})})]}),e.jsxs("button",{onClick:()=>ce(s),className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-colors text-sm",children:[e.jsx(Ce,{className:"w-4 h-4"}),s.managerId?"Change Manager":"Assign Manager"]}),e.jsxs("button",{onClick:()=>ge(s),className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-orange-100 text-orange-700 rounded-lg hover:bg-orange-200 transition-colors text-sm",children:[e.jsx(se,{className:"w-4 h-4"}),s.productionHouseId?"Change Production House":"Assign Production House"]}),c==="cluster_head"&&e.jsxs("button",{onClick:()=>xe(s),className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors text-sm",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Migrate Data"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["ID: ",s.id]})]})]})},s.id))})]})}function Ze({context:r}){const[c,y]=l.useState([]),[m,g]=l.useState([]),[h,d]=l.useState(!1),[u,j]=l.useState(!1);l.useEffect(()=>{r.managedStoreIds&&r.managedProductionHouseIds&&(y(r.managedStoreIds),g(r.managedProductionHouseIds))},[r.managedStoreIds,r.managedProductionHouseIds]),l.useEffect(()=>{const n=JSON.stringify([...c].sort())!==JSON.stringify([...r.managedStoreIds||[]].sort()),i=JSON.stringify([...m].sort())!==JSON.stringify([...r.managedProductionHouseIds||[]].sort());j(n||i)},[c,m,r.managedStoreIds,r.managedProductionHouseIds]);const R=n=>{y(i=>i.includes(n)?i.filter(f=>f!==n):[...i,n])},C=n=>{g(i=>i.includes(n)?i.filter(f=>f!==n):[...i,n])},I=async()=>{if(!r.user?.employeeId||!r.user?.accessToken){N.error("Employee ID not found");return}d(!0);try{await Te(r.user.accessToken,r.user.employeeId,c,m),N.success("Cluster assignments updated successfully! Refreshing..."),setTimeout(()=>{window.location.reload()},1e3)}catch(n){console.error("Error updating cluster assignments:",n),N.error("Failed to update cluster assignments")}finally{d(!1)}},D=()=>{y(r.managedStoreIds||[]),g(r.managedProductionHouseIds||[])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(oe,{className:"w-8 h-8"}),e.jsx("h2",{className:"text-2xl",children:"Cluster Management"})]}),e.jsx("p",{className:"text-purple-100",children:"Assign stores and production houses to your cluster. You'll be able to view reports and analytics for all assigned locations."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-6 text-white",children:[e.jsx(J,{className:"w-8 h-8 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Assigned Stores"}),e.jsx("p",{className:"text-3xl",children:c.length}),e.jsxs("p",{className:"text-xs opacity-75 mt-1",children:["of ",r.stores.length," total"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-6 text-white",children:[e.jsx(te,{className:"w-8 h-8 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Production Houses"}),e.jsx("p",{className:"text-3xl",children:m.length}),e.jsxs("p",{className:"text-xs opacity-75 mt-1",children:["of ",r.productionHouses.length," total"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-6 text-white",children:[e.jsx(Le,{className:"w-8 h-8 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Total Locations"}),e.jsx("p",{className:"text-3xl",children:c.length+m.length}),e.jsx("p",{className:"text-xs opacity-75 mt-1",children:"in your cluster"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(J,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-lg text-gray-900",children:"Stores"}),e.jsxs("span",{className:"ml-auto text-sm text-gray-500",children:[c.length," selected"]})]}),r.stores.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No stores available"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:r.stores.map(n=>{const i=c.includes(n.id);return e.jsxs("button",{onClick:()=>R(n.id),className:`flex items-center gap-3 p-4 rounded-lg border-2 transition-all text-left ${i?"border-purple-500 bg-purple-50":"border-gray-200 bg-white hover:border-purple-300"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center ${i?"border-purple-500 bg-purple-500":"border-gray-300 bg-white"}`,children:i&&e.jsx(K,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-900",children:n.name}),e.jsx("p",{className:"text-xs text-gray-500",children:n.location})]})]},n.id)})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(te,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-lg text-gray-900",children:"Production Houses"}),e.jsxs("span",{className:"ml-auto text-sm text-gray-500",children:[m.length," selected"]})]}),r.productionHouses.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No production houses available"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:r.productionHouses.map(n=>{const i=m.includes(n.id);return e.jsxs("button",{onClick:()=>C(n.id),className:`flex items-center gap-3 p-4 rounded-lg border-2 transition-all text-left ${i?"border-purple-500 bg-purple-50":"border-gray-200 bg-white hover:border-purple-300"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center ${i?"border-purple-500 bg-purple-500":"border-gray-300 bg-white"}`,children:i&&e.jsx(K,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-900",children:n.name}),e.jsx("p",{className:"text-xs text-gray-500",children:n.location})]})]},n.id)})})]}),u&&e.jsx("div",{className:"sticky bottom-0 bg-white border-t-2 border-gray-200 p-4 rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex gap-3 max-w-4xl mx-auto",children:[e.jsx("button",{onClick:D,disabled:h,className:"flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors disabled:opacity-50",children:"Cancel Changes"}),e.jsx("button",{onClick:I,disabled:h,className:"flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-5 h-5"}),"Save Cluster Assignments"]})})]})})]})}function Ge({context:r}){const[c,y]=l.useState([]),[m,g]=l.useState(!0),[h,d]=l.useState(!1),[u,j]=l.useState(null),[R,C]=l.useState([]),[I,D]=l.useState([]),[n,i]=l.useState(""),[f,U]=l.useState(""),[M,w]=l.useState(""),[P,A]=l.useState(""),[H,E]=l.useState(""),[L,T]=l.useState(!1);l.useEffect(()=>{S(),q(),O()},[r.user]);const S=async()=>{if(r.user?.accessToken)try{g(!0);const a=await $e(r.user.accessToken);y(a)}catch(a){console.error("Error loading investors:",a),N.error("Failed to load investors")}finally{g(!1)}},q=async()=>{if(r.user?.accessToken)try{const a=await Fe(r.user.accessToken);C(a)}catch(a){console.error("Error loading loans:",a)}},O=async()=>{if(r.user?.accessToken)try{const a=await Re(r.user.accessToken);D(a)}catch(a){console.error("Error loading repayments:",a)}},X=async a=>{if(a.preventDefault(),!!r.user?.accessToken)try{T(!0);const o={name:n,contactNumber:f,email:M,address:P,notes:H,createdBy:r.user.email};u?(await Be(r.user.accessToken,u.id,o),N.success("Investor updated successfully")):(await ze(r.user.accessToken,o),N.success("Investor added successfully")),b(),d(!1),S()}catch(o){console.error("Error saving investor:",o),N.error("Failed to save investor")}finally{T(!1)}},Y=a=>{j(a),i(a.name),U(a.contactNumber||""),w(a.email||""),A(a.address||""),E(a.notes||""),d(!0)},$=async a=>{if(r.user?.accessToken&&confirm("Are you sure you want to delete this investor?"))try{await _e(r.user.accessToken,a),N.success("Investor deleted successfully"),S()}catch(o){console.error("Error deleting investor:",o),N.error("Failed to delete investor")}},b=()=>{i(""),U(""),w(""),A(""),E(""),j(null)},_=a=>{const o=R.filter(p=>p.investorId===a),x=o.reduce((p,v)=>p+v.loanAmount,0),F=o.reduce((p,v)=>p+v.repaidAmount,0),B=o.reduce((p,v)=>{const V=(v.interestRate||0)/100*v.loanAmount;return p+V},0),k=o.filter(p=>p.status==="active").length,Z=x+B-F;return{totalLent:x,totalRepaid:F,totalInterest:B,activeLoans:k,outstanding:Z,investorLoans:o}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Investors & Investment Analytics"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage investors and track loan repayments"})]}),e.jsxs("button",{onClick:()=>{b(),d(!0)},className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-500 text-white rounded-lg hover:from-purple-700 hover:to-pink-600 transition-all shadow-lg",children:[e.jsx(ee,{className:"w-5 h-5"}),"Add Investor"]})]}),m?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})}):c.length===0?e.jsxs("div",{className:"bg-gray-50 rounded-xl p-12 text-center border-2 border-dashed border-gray-300",children:[e.jsx(G,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Investors Yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Add your first investor to start tracking investments and loans"}),e.jsxs("button",{onClick:()=>{b(),d(!0)},className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-500 text-white rounded-lg hover:from-purple-700 hover:to-pink-600 transition-all shadow-lg",children:[e.jsx(ee,{className:"w-5 h-5"}),"Add First Investor"]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:c.map(a=>{const o=_(a.id);return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-purple-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-500 p-6 text-white",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center",children:e.jsx(G,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:a.name}),a.contactNumber&&e.jsxs("div",{className:"flex items-center gap-2 text-purple-100 text-sm mt-1",children:[e.jsx(le,{className:"w-3 h-3"}),a.contactNumber]})]})]}),a.email&&e.jsxs("div",{className:"flex items-center gap-2 text-purple-100 text-sm",children:[e.jsx(ae,{className:"w-3 h-3"}),a.email]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Y(a),className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>$(a.id),className:"p-2 bg-white/20 hover:bg-red-500 rounded-lg transition-colors",children:e.jsx(Ue,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-purple-600"}),"Investment Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Lent"}),e.jsxs("p",{className:"text-xl font-bold text-blue-600",children:["â‚¹",o.totalLent.toLocaleString()]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Repaid"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["â‚¹",o.totalRepaid.toLocaleString()]})]}),e.jsxs("div",{className:"bg-amber-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Interest Accrued"}),e.jsxs("p",{className:"text-xl font-bold text-amber-600",children:["â‚¹",o.totalInterest.toFixed(2)]})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Outstanding"}),e.jsxs("p",{className:"text-xl font-bold text-red-600",children:["â‚¹",o.outstanding.toFixed(2)]})]})]}),o.activeLoans>0&&e.jsx("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm font-semibold text-purple-900",children:[o.activeLoans," Active Loan",o.activeLoans!==1?"s":""]})}),o.investorLoans.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Recent Loans"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:o.investorLoans.slice(0,5).map(x=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["â‚¹",x.loanAmount.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[x.loanDate," â€¢ ",x.interestRate||0,"% interest"]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${x.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:x.status})]},x.id))})]}),a.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-800",children:a.notes})]})]})]},a.id)})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:()=>{d(!1),b()},children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",onClick:a=>a.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ee,{className:"w-6 h-6"}),u?"Edit Investor":"Add New Investor"]}),e.jsx("p",{className:"text-purple-100 mt-1",children:"Enter investor details"})]}),e.jsx("button",{onClick:()=>{d(!1),b()},className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(Oe,{className:"w-6 h-6"})})]})}),e.jsxs("form",{onSubmit:X,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Investor Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-5 h-5"}),e.jsx("input",{type:"text",value:n,onChange:a=>i(a.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter investor name",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Contact Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-5 h-5"}),e.jsx("input",{type:"tel",value:f,onChange:a=>U(a.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter contact number"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 w-5 h-5"}),e.jsx("input",{type:"email",value:M,onChange:a=>w(a.target.value),className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter email address"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute left-3 top-3 text-gray-500 w-5 h-5"}),e.jsx("textarea",{value:P,onChange:a=>A(a.target.value),rows:2,className:"w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter address"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:H,onChange:a=>E(a.target.value),rows:3,className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Additional notes about this investor"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{d(!1),b()},className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",disabled:L,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:L||!n,className:"flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-5 h-5"}),u?"Update Investor":"Add Investor"]})})]})]})]})})]})}function es({context:r,stores:c,employees:y,onRefreshStores:m}){const g=r.user?.role==="cluster_head",[h,d]=l.useState("assets"),[u,j]=l.useState(g?"cluster-management":"stores");return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-r from-purple-600 via-pink-500 to-purple-600 rounded-2xl p-8 shadow-xl",children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 backdrop-blur-sm"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border-2 border-white/30",children:e.jsx(re,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl text-white mb-1",children:"Investments & Assets Management"}),e.jsx("p",{className:"text-white/80 text-sm",children:"Manage your investors, stores, and production houses"})]})]}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs("button",{onClick:()=>d("assets"),className:`flex items-center gap-2 px-6 py-3 rounded-xl transition-all backdrop-blur-sm border-2 ${h==="assets"?"bg-white text-purple-600 border-white shadow-lg":"bg-white/20 text-white border-white/30 hover:bg-white/30"}`,children:[e.jsx(re,{className:"w-5 h-5"}),e.jsx("span",{children:"Assets"})]}),e.jsxs("button",{onClick:()=>d("investments"),className:`flex items-center gap-2 px-6 py-3 rounded-xl transition-all backdrop-blur-sm border-2 ${h==="investments"?"bg-white text-purple-600 border-white shadow-lg":"bg-white/20 text-white border-white/30 hover:bg-white/30"}`,children:[e.jsx(ne,{className:"w-5 h-5"}),e.jsx("span",{children:"Investments"})]})]}),h==="assets"&&e.jsxs("div",{className:"flex gap-3",children:[g&&e.jsxs("button",{onClick:()=>j("cluster-management"),className:`flex items-center gap-2 px-6 py-3 rounded-xl transition-all backdrop-blur-sm border-2 ${u==="cluster-management"?"bg-white text-purple-600 border-white shadow-lg":"bg-white/20 text-white border-white/30 hover:bg-white/30"}`,children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Cluster Settings"})]}),e.jsxs("button",{onClick:()=>j("stores"),className:`flex items-center gap-2 px-6 py-3 rounded-xl transition-all backdrop-blur-sm border-2 ${u==="stores"?"bg-white text-purple-600 border-white shadow-lg":"bg-white/20 text-white border-white/30 hover:bg-white/30"}`,children:[e.jsx(J,{className:"w-5 h-5"}),e.jsx("span",{children:"Stores"})]}),e.jsxs("button",{onClick:()=>j("production-houses"),className:`flex items-center gap-2 px-6 py-3 rounded-xl transition-all backdrop-blur-sm border-2 ${u==="production-houses"?"bg-white text-purple-600 border-white shadow-lg":"bg-white/20 text-white border-white/30 hover:bg-white/30"}`,children:[e.jsx(se,{className:"w-5 h-5"}),e.jsx("span",{children:"Production Houses"})]})]})]})]})}),e.jsx("div",{children:h==="investments"?e.jsx(Ge,{context:r}):u==="cluster-management"?e.jsx(Ze,{context:r}):u==="stores"?e.jsx(Ye,{onStoreCreated:m,userRole:r.user?.role}):e.jsx(Je,{context:r,stores:c,employees:y,onRefreshStores:m})})]})}export{es as AssetsManagement};
